<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© Ù…Ø¹ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± ÙˆØ§Ù„ÙÙ†Ø¯Ù‚</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 5px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
            min-width: 120px;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fa;
            direction: ltr;
            text-align: center;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .range-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .calculate-btn {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .results-container {
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .results-table thead {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .results-table th,
        .results-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #e0e6ed;
            font-size: 0.85rem;
        }

        .results-table th {
            font-weight: 600;
            white-space: nowrap;
        }

        .results-table tbody tr {
            transition: all 0.3s ease;
        }

        .results-table tbody tr:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            transform: scale(1.01);
        }

        .results-table tbody tr:nth-child(even) {
            background: rgba(248, 249, 250, 0.5);
        }

        .profit-positive {
            color: #27ae60;
            font-weight: 600;
        }

        .profit-negative {
            color: #e74c3c;
            font-weight: 600;
        }

        .roi-excellent {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
            font-weight: 700;
        }

        .roi-good {
            background: rgba(241, 196, 15, 0.1);
            color: #f39c12;
            font-weight: 600;
        }

        .roi-poor {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            font-weight: 600;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.2);
        }

        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .summary-card .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .rental-highlight {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(46, 204, 113, 0.1));
            border-color: rgba(39, 174, 96, 0.3);
        }

        .rental-highlight .value {
            color: #27ae60;
        }

        .hotel-highlight {
            background: linear-gradient(135deg, rgba(230, 126, 34, 0.1), rgba(231, 76, 60, 0.1));
            border-color: rgba(230, 126, 34, 0.3);
        }

        .hotel-highlight .value {
            color: #e67e22;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .export-buttons {
            margin-top: 20px;
            text-align: center;
            gap: 10px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 10px 20px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .export-btn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }

        .payback-good {
            color: #27ae60;
            font-weight: 600;
        }

        .payback-fair {
            color: #f39c12;
            font-weight: 600;
        }

        .payback-poor {
            color: #e74c3c;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .inputs-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .range-inputs {
                grid-template-columns: 1fr;
            }

            .results-table {
                font-size: 0.7rem;
            }

            .results-table th,
            .results-table td {
                padding: 6px 4px;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© Ù…Ø¹ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± ÙˆØ§Ù„ÙÙ†Ø¯Ù‚</h1>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('sale')">Ø§Ù„Ø¨ÙŠØ¹</div>
            <div class="tab" onclick="switchTab('rental')">Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</div>
            <div class="tab" onclick="switchTab('hotel')">ÙÙ†Ø¯Ù‚</div>
            <div class="tab" onclick="switchTab('comparison')">Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</div>
        </div>

        <div class="inputs-grid">
            <div class="input-group">
                <label for="landArea">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø£Ø±Ø¶ (Ù…Â²)</label>
                <input type="number" id="landArea" value="4000" min="0" step="100">
            </div>
            <div class="input-group">
                <label for="landCost">Ø³Ø¹Ø± Ù…ØªØ± Ø§Ù„Ø£Ø±Ø¶ (Ø±ÙŠØ§Ù„)</label>
                <input type="number" id="landCost" value="15000" min="0" step="100">
            </div>
            <div class="input-group">
                <label for="buildRatio">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ (%)</label>
                <input type="number" id="buildRatio" value="50" min="0" max="100" step="1">
            </div>
            <div class="input-group">
                <label for="buildCost">ØªÙƒÙ„ÙØ© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ± Ù„Ù„Ø´Ù‚Ù‚ (Ø±ÙŠØ§Ù„)</label>
                <input type="number" id="buildCost" value="6500" min="0" step="50">
            </div>
            <div class="input-group">
                <label for="hotelBuildCost">ØªÙƒÙ„ÙØ© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ± Ù„Ù„ÙÙ†Ø¯Ù‚ (Ø±ÙŠØ§Ù„)</label>
                <input type="number" id="hotelBuildCost" value="3500" min="0" step="50">
            </div>
            <div class="input-group">
                <label for="apartmentSize">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø´Ù‚Ø© (Ù…Â²)</label>
                <input type="number" id="apartmentSize" value="140" min="0" step="10">
            </div>
            <div class="input-group">
                <label for="sellPrice">Ø³Ø¹Ø± Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„) Ù„Ù„Ø´Ù‚Ø©</label>
                <input type="number" id="sellPrice" value="7000" min="0" step="100">
            </div>
            <div class="input-group">
                <label for="rentPrice">Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ù…ØªØ± Ø³Ù†ÙˆÙŠØ§Ù‹ (Ø±ÙŠØ§Ù„) Ù„Ù„Ø´Ù‚Ø©</label>
                <input type="number" id="rentPrice" value="1200" min="0" step="10">
            </div>
            <div class="input-group">
                <label for="occupancyRate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø´ØºØ§Ù„ (%) Ù„Ù„Ø´Ù‚Ù‚</label>
                <input type="number" id="occupancyRate" value="70" min="0" max="100" step="1">
            </div>
            <div class="input-group">
                <label for="roomSize">Ù…ØªÙˆØ³Ø· Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØºØ±ÙØ© (Ù…Â²) Ù„Ù„ÙÙ†Ø¯Ù‚</label>
                <input type="number" id="roomSize" value="50" min="0" step="1">
            </div>
            <div class="input-group">
                <label for="roomRate">Ø³Ø¹Ø± Ø§Ù„ØºØ±ÙØ© ÙÙŠ Ø§Ù„Ù„ÙŠÙ„Ø© (Ø±ÙŠØ§Ù„) Ù„Ù„ÙÙ†Ø¯Ù‚</label>
                <input type="number" id="roomRate" value="600" min="0" step="10">
            </div>
            <div class="input-group">
                <label for="hotelOccupancy">Ù…Ø¹Ø¯Ù„ Ø¥Ø´ØºØ§Ù„ Ø§Ù„ÙÙ†Ø¯Ù‚ (%)</label>
                <input type="number" id="hotelOccupancy" value="70" min="0" max="100" step="1">
            </div>
            <div class="input-group">
                <label for="operatingCosts">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© Ø§Ù„Ø³Ù†ÙˆÙŠØ© (%) Ù„Ù„ÙÙ†Ø¯Ù‚</label>
                <input type="number" id="operatingCosts" value="30" min="0" max="100" step="1">
            </div>
            <div class="input-group">
                <label for="buildingDepreciation">Ø¥Ù‡Ù„Ø§Ùƒ Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø³Ù†ÙˆÙŠ (%) Ù„Ù„ÙÙ†Ø¯Ù‚</label>
                <input type="number" id="buildingDepreciation" value="10" min="0" max="10" step="0.5">
            </div>
            <div class="input-group">
                <label for="landRent">Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ø³Ù†ÙˆÙŠ (%) Ù„Ù„ÙÙ†Ø¯Ù‚</label>
                <input type="number" id="landRent" value="5" min="0" max="20" step="0.5">
            </div>
            <div class="input-group">
                <label>Ù†Ø·Ø§Ù‚ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</label>
                <div class="range-inputs">
                    <input type="number" id="minFloors" value="10" min="1" placeholder="Ù…Ù†" step="1">
                    <input type="number" id="maxFloors" value="14" min="1" placeholder="Ø¥Ù„Ù‰" step="1">
                </div>
            </div>
        </div>

        <button class="calculate-btn" onclick="calculate()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ø¯</button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...</p>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards" id="summaryCards" style="display: none;">
            <div class="summary-card" id="card1">
                <h3 id="card1Title">Ø£ÙØ¶Ù„ Ø¹Ø§Ø¦Ø¯ Ø§Ø³ØªØ«Ù…Ø§Ø±</h3>
                <div class="value" id="card1Value">-</div>
            </div>
            <div class="summary-card" id="card2">
                <h3 id="card2Title">Ø£Ø¹Ù„Ù‰ Ø±Ø¨Ø­/Ø¯Ø®Ù„</h3>
                <div class="value" id="card2Value">-</div>
            </div>
            <div class="summary-card" id="card3">
                <h3 id="card3Title">Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ù„Ø£Ø¯ÙˆØ§Ø±</h3>
                <div class="value" id="card3Value">-</div>
            </div>
            <div class="summary-card" id="card4" style="display: none;">
                <h3 id="card4Title">ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</h3>
                <div class="value" id="card4Value">-</div>
            </div>
        </div>

        <!-- Results Table -->
        <div class="results-container" id="resultsContainer" style="display: none;">
            <table class="results-table" id="resultsTable">
                <thead id="tableHead">
                    <!-- Table headers will be populated by JavaScript -->
                </thead>
                <tbody id="tableBody">
                    <!-- Table data will be populated by JavaScript -->
                </tbody>
            </table>
            
            <div class="export-buttons">
                <button class="export-btn" onclick="exportToCSV()">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV</button>
                <button class="export-btn" onclick="exportToPDF()">Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸ PDF</button>
                <button class="export-btn" onclick="copyToClipboard()">Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'sale';
        let calculationResults = {
            sale: [],
            rental: [],
            hotel: [],
            comparison: []
        };

        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            const tabs = document.querySelectorAll('.tab');
            const tabIndex = tabName === 'sale' ? 0 : tabName === 'rental' ? 1 : tabName === 'hotel' ? 2 : 3;
            tabs[tabIndex].classList.add('active');
            
            // Update display
            updateDisplay();
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-US').format(Math.round(num));
        }

        function getROIClass(roi) {
            if (roi >= 30) return 'roi-excellent';
            if (roi >= 15) return 'roi-good';
            return 'roi-poor';
        }

        function getProfitClass(profit) {
            return profit >= 0 ? 'profit-positive' : 'profit-negative';
        }

        function getPaybackClass(years) {
            if (years <= 10) return 'payback-good';
            if (years <= 20) return 'payback-fair';
            return 'payback-poor';
        }

        function updateDisplay() {
            const results = calculationResults[currentTab];
            if (!results || results.length === 0) return;

            // Update summary cards
            updateSummaryCards();
            
            // Update table
            updateTable();
        }

        function updateSummaryCards() {
            const results = calculationResults[currentTab];
            const card4 = document.getElementById('card4');
            
            if (currentTab === 'sale') {
                const bestROI = Math.max(...results.map(r => r.roi));
                const maxProfit = Math.max(...results.map(r => r.profit));
                const optimalFloors = results.find(r => r.roi === bestROI)?.floors || 0;
                
                document.getElementById('card1Title').textContent = 'Ø£ÙØ¶Ù„ Ø¹Ø§Ø¦Ø¯ Ø§Ø³ØªØ«Ù…Ø§Ø± (Ø¨ÙŠØ¹)';
                document.getElementById('card1Value').textContent = `${bestROI.toFixed(2)}%`;
                document.getElementById('card2Title').textContent = 'Ø£Ø¹Ù„Ù‰ Ø±Ø¨Ø­ (Ø¨ÙŠØ¹)';
                document.getElementById('card2Value').textContent = formatNumber(maxProfit);
                document.getElementById('card3Title').textContent = 'Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ù„Ø£Ø¯ÙˆØ§Ø±';
                document.getElementById('card3Value').textContent = `${optimalFloors} Ø£Ø¯ÙˆØ§Ø±`;
                card4.style.display = 'none';
                
            } else if (currentTab === 'rental') {
                const bestROI = Math.max(...results.map(r => r.roi));
                const maxIncome = Math.max(...results.map(r => r.annualIncome));
                const optimalFloors = results.find(r => r.roi === bestROI)?.floors || 0;
                const bestPayback = Math.min(...results.map(r => r.paybackPeriod).filter(p => p !== Infinity));
                
                document.getElementById('card1Title').textContent = 'Ø£ÙØ¶Ù„ Ø¹Ø§Ø¦Ø¯ Ø§Ø³ØªØ«Ù…Ø§Ø± (Ø¥ÙŠØ¬Ø§Ø±)';
                document.getElementById('card1Value').textContent = `${bestROI.toFixed(2)}%`;
                document.getElementById('card2Title').textContent = 'Ø£Ø¹Ù„Ù‰ Ø¯Ø®Ù„ Ø³Ù†ÙˆÙŠ';
                document.getElementById('card2Value').textContent = formatNumber(maxIncome);
                document.getElementById('card3Title').textContent = 'Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ù„Ø£Ø¯ÙˆØ§Ø±';
                document.getElementById('card3Value').textContent = `${optimalFloors} Ø£Ø¯ÙˆØ§Ø±`;
                document.getElementById('card4Title').textContent = 'Ø£Ù‚Ù„ ÙØªØ±Ø© Ø§Ø³ØªØ±Ø¯Ø§Ø¯';
                document.getElementById('card4Value').textContent = bestPayback === Infinity ? 'âˆ' : `${bestPayback.toFixed(1)} Ø³Ù†Ø©`;
                card4.style.display = 'block';
                
                // Update card styles
                document.querySelectorAll('.summary-card').forEach(card => {
                    card.className = 'summary-card rental-highlight';
                });
                
            } else if (currentTab === 'hotel') {
                const bestROI = Math.max(...results.map(r => r.roi));
                const maxIncome = Math.max(...results.map(r => r.netIncome));
                const optimalFloors = results.find(r => r.roi === bestROI)?.floors || 0;
                const bestPayback = Math.min(...results.map(r => r.paybackPeriod).filter(p => p !== Infinity));
                
                document.getElementById('card1Title').textContent = 'Ø£ÙØ¶Ù„ Ø¹Ø§Ø¦Ø¯ Ø§Ø³ØªØ«Ù…Ø§Ø± (ÙÙ†Ø¯Ù‚)';
                document.getElementById('card1Value').textContent = `${bestROI.toFixed(2)}%`;
                document.getElementById('card2Title').textContent = 'Ø£Ø¹Ù„Ù‰ Ø¯Ø®Ù„ Ø³Ù†ÙˆÙŠ ØµØ§ÙÙŠ';
                document.getElementById('card2Value').textContent = formatNumber(maxIncome);
                document.getElementById('card3Title').textContent = 'Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ù„Ø£Ø¯ÙˆØ§Ø±';
                document.getElementById('card3Value').textContent = `${optimalFloors} Ø£Ø¯ÙˆØ§Ø±`;
                document.getElementById('card4Title').textContent = 'Ø£Ù‚Ù„ ÙØªØ±Ø© Ø§Ø³ØªØ±Ø¯Ø§Ø¯';
                document.getElementById('card4Value').textContent = bestPayback === Infinity ? 'âˆ' : `${bestPayback.toFixed(1)} Ø³Ù†Ø©`;
                card4.style.display = 'block';
                
                // Update card styles
                document.querySelectorAll('.summary-card').forEach(card => {
                    card.className = 'summary-card hotel-highlight';
                });
                
            } else if (currentTab === 'comparison') {
                card4.style.display = 'none';
                document.getElementById('card1Title').textContent = 'Ø£ÙØ¶Ù„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©';
                document.getElementById('card2Title').textContent = 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ø¦Ø¯';
                document.getElementById('card3Title').textContent = 'Ø§Ù„ØªÙˆØµÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©';
                
                // Calculate best overall strategy
                const strategies = ['Ø§Ù„Ø¨ÙŠØ¹', 'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±', 'Ø§Ù„ÙÙ†Ø¯Ù‚'];
                const avgROIs = {
                    'Ø§Ù„Ø¨ÙŠØ¹': results.reduce((sum, r) => sum + r.saleROI, 0) / results.length,
                    'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±': results.reduce((sum, r) => sum + r.rentalROI, 0) / results.length,
                    'Ø§Ù„ÙÙ†Ø¯Ù‚': results.reduce((sum, r) => sum + r.hotelROI, 0) / results.length
                };
                
                const bestStrategy = Object.keys(avgROIs).reduce((a, b) => avgROIs[a] > avgROIs[b] ? a : b);
                
                document.getElementById('card1Value').textContent = bestStrategy;
                document.getElementById('card2Value').textContent = `${avgROIs[bestStrategy].toFixed(2)}%`;
                document.getElementById('card3Value').textContent = bestStrategy;
                
                // Reset card styles
                document.querySelectorAll('.summary-card').forEach(card => {
                    card.className = 'summary-card';
                });
            }
        }

        function updateTable() {
            const results = calculationResults[currentTab];
            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');
            
            // Clear existing content
            tableHead.innerHTML = '';
            tableBody.innerHTML = '';
            
            if (currentTab === 'sale') {
                tableHead.innerHTML = `
                    <tr>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</th>
                        <th>Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ (Ù…Â²)</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚</th>
                        <th>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø±Ø¨Ø­ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± (%)</th>
                        <th>Ø³Ø¹Ø± Ø§Ù„ØªØ¹Ø§Ø¯Ù„ Ù„Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„)</th>
                    </tr>
                `;
                
                results.forEach(result => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${result.floors}</td>
                        <td>${formatNumber(result.totalBuildArea)}</td>
                        <td>${result.numApts}</td>
                        <td>${formatNumber(result.totalCost)}</td>
                        <td>${formatNumber(result.revenue)}</td>
                        <td class="${getProfitClass(result.profit)}">${formatNumber(result.profit)}</td>
                        <td class="${getROIClass(result.roi)}">${result.roi.toFixed(2)}%</td>
                        <td>${formatNumber(result.breakeven)}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
            } else if (currentTab === 'rental') {
                tableHead.innerHTML = `
                    <tr>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</th>
                        <th>Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ (Ù…Â²)</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚</th>
                        <th>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)</th>
                        <th>ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ (Ø³Ù†Ø©)</th>
                    </tr>
                `;
                
                results.forEach(result => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${result.floors}</td>
                        <td>${formatNumber(result.totalBuildArea)}</td>
                        <td>${result.numApts}</td>
                        <td>${formatNumber(result.totalCost)}</td>
                        <td>${formatNumber(result.monthlyIncome)}</td>
                        <td class="profit-positive">${formatNumber(result.annualIncome)}</td>
                        <td class="${getROIClass(result.roi)}">${result.roi.toFixed(2)}%</td>
                        <td class="${getPaybackClass(result.paybackPeriod)}">${result.paybackPeriod === Infinity ? 'âˆ' : result.paybackPeriod.toFixed(1)}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
            } else if (currentTab === 'hotel') {
                tableHead.innerHTML = `
                    <tr>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</th>
                        <th>Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ (Ù…Â²)</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù</th>
                        <th>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¥Ù‡Ù„Ø§Ùƒ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø£Ø±Ø¶ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„ØµØ§ÙÙŠ (Ø±ÙŠØ§Ù„)</th>
                        <th>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ØµØ§ÙÙŠ (%)</th>
                        <th>ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ (Ø³Ù†Ø©)</th>
                    </tr>
                `;
                
                results.forEach(result => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${result.floors}</td>
                        <td>${formatNumber(result.totalBuildArea)}</td>
                        <td>${result.numRooms}</td>
                        <td>${formatNumber(result.totalCost)}</td>
                        <td class="profit-positive">${formatNumber(result.grossRevenue)}</td>
                        <td class="profit-negative">${formatNumber(result.operatingCosts)}</td>
                        <td class="profit-negative">${formatNumber(result.depreciation)}</td>
                        <td class="profit-negative">${formatNumber(result.landRentCost)}</td>
                        <td class="profit-negative">${formatNumber(result.totalCosts)}</td>
                        <td class="${getProfitClass(result.netIncome)}">${formatNumber(result.netIncome)}</td>
                        <td class="${getROIClass(result.roi)}">${result.roi.toFixed(2)}%</td>
                        <td class="${getPaybackClass(result.paybackPeriod)}">${result.paybackPeriod === Infinity ? 'âˆ' : result.paybackPeriod.toFixed(1)}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
            } else if (currentTab === 'comparison') {
                tableHead.innerHTML = `
                    <tr>
                        <th rowspan="2" style="vertical-align: middle; background: #34495e; color: white; font-size: 1.1em; padding: 15px;">Ø¹Ø¯Ø¯<br/>Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</th>
                        <th colspan="3" style="background: linear-gradient(135deg, #3498db, #2ecc71, #e67e22); color: white; text-align: center; font-size: 1.3em; padding: 15px;">ğŸ” Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„Ø«Ù„Ø§Ø« Ù…Ø¹ Ø§Ù„Ø¹ÙˆØ§Ø¦Ø¯</th>
                        <th rowspan="2" style="vertical-align: middle; background: #8e44ad; color: white; font-size: 1.1em; padding: 15px;">ğŸ† Ø£ÙØ¶Ù„<br/>Ø§Ø®ØªÙŠØ§Ø±</th>
                    </tr>
                    <tr>
                        <th style="background: rgba(52, 152, 219, 0.9); color: white; font-size: 1em; padding: 12px; border: 2px solid #2980b9; min-width: 150px;">
                            ğŸ¢ <strong>Ø§Ù„Ø¨ÙŠØ¹</strong><br/>
                            <div style="font-size: 0.8em; margin-top: 3px; opacity: 0.9;">Ø§Ù„Ø¹Ø§Ø¦Ø¯ % + Ø§Ù„Ø±Ø¨Ø­</div>
                        </th>
                        <th style="background: rgba(46, 204, 113, 0.9); color: white; font-size: 1em; padding: 12px; border: 2px solid #27ae60; min-width: 150px;">
                            ğŸ  <strong>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</strong><br/>
                            <div style="font-size: 0.8em; margin-top: 3px; opacity: 0.9;">Ø§Ù„Ø¹Ø§Ø¦Ø¯ % + Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</div>
                        </th>
                        <th style="background: rgba(230, 126, 34, 0.9); color: white; font-size: 1em; padding: 12px; border: 2px solid #d35400; min-width: 150px;">
                            ğŸ¨ <strong>Ø§Ù„ÙÙ†Ø¯Ù‚</strong><br/>
                            <div style="font-size: 0.8em; margin-top: 3px; opacity: 0.9;">Ø§Ù„Ø¹Ø§Ø¦Ø¯ % + Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„ØµØ§ÙÙŠ</div>
                        </th>
                    </tr>
                `;
                
                results.forEach(result => {
                    const row = document.createElement('tr');
                    
                    // Determine which strategy is best for highlighting
                    let saleClass = result.recommendation === 'Ø§Ù„Ø¨ÙŠØ¹' ? 'roi-excellent' : '';
                    let rentalClass = result.recommendation === 'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±' ? 'roi-excellent' : '';
                    let hotelClass = result.recommendation === 'Ø§Ù„ÙÙ†Ø¯Ù‚' ? 'roi-excellent' : '';
                    
                    // Add winner styling
                    let saleStyle = result.recommendation === 'Ø§Ù„Ø¨ÙŠØ¹' ? 
                        'border: 4px solid #27ae60; box-shadow: 0 0 15px rgba(39, 174, 96, 0.6); background: rgba(39, 174, 96, 0.1);' : 
                        'border: 2px solid #bdc3c7; background: rgba(52, 152, 219, 0.05);';
                    
                    let rentalStyle = result.recommendation === 'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±' ? 
                        'border: 4px solid #27ae60; box-shadow: 0 0 15px rgba(39, 174, 96, 0.6); background: rgba(39, 174, 96, 0.1);' : 
                        'border: 2px solid #bdc3c7; background: rgba(46, 204, 113, 0.05);';
                    
                    let hotelStyle = result.recommendation === 'Ø§Ù„ÙÙ†Ø¯Ù‚' ? 
                        'border: 4px solid #27ae60; box-shadow: 0 0 15px rgba(39, 174, 96, 0.6); background: rgba(39, 174, 96, 0.1);' : 
                        'border: 2px solid #bdc3c7; background: rgba(230, 126, 34, 0.05);';
                    
                    let recommendationClass = 'profit-positive';
                    let recommendationIcon = 'ğŸ¢';
                    let recommendationText = 'Ø§Ù„Ø¨ÙŠØ¹';
                    let winnerBadge = '';
                    
                    if (result.recommendation === 'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±') {
                        recommendationClass = 'rental-highlight';
                        recommendationIcon = 'ğŸ ';
                        recommendationText = 'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±';
                    } else if (result.recommendation === 'Ø§Ù„ÙÙ†Ø¯Ù‚') {
                        recommendationClass = 'hotel-highlight';
                        recommendationIcon = 'ğŸ¨';
                        recommendationText = 'Ø§Ù„ÙÙ†Ø¯Ù‚';
                    }
                    
                    winnerBadge = `<div style="background: #27ae60; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7em; margin-top: 2px;">ğŸ† Ø§Ù„ÙØ§Ø¦Ø²</div>`;
                    
                    row.innerHTML = `
                        <td style="font-weight: bold; font-size: 1.3em; text-align: center; background: #ecf0f1; border: 3px solid #34495e; vertical-align: middle;">${result.floors}</td>
                        
                        <td class="${saleClass}" style="text-align: center; padding: 15px; ${saleStyle} vertical-align: middle;">
                            <div style="font-size: 1.4em; font-weight: bold; color: #2980b9; margin-bottom: 5px;">
                                ğŸ“Š ${result.saleROI.toFixed(1)}%
                            </div>
                            <div style="font-size: 1em; color: #34495e; font-weight: 600; margin-bottom: 3px;">
                                ğŸ’° ${formatNumber(result.saleProfit)}
                            </div>
                            <div style="font-size: 0.8em; color: #7f8c8d; font-style: italic;">
                                Ø±Ø¨Ø­ ÙÙˆØ±ÙŠ
                            </div>
                            ${result.recommendation === 'Ø§Ù„Ø¨ÙŠØ¹' ? winnerBadge : ''}
                        </td>
                        
                        <td class="${rentalClass}" style="text-align: center; padding: 15px; ${rentalStyle} vertical-align: middle;">
                            <div style="font-size: 1.4em; font-weight: bold; color: #27ae60; margin-bottom: 5px;">
                                ğŸ“Š ${result.rentalROI.toFixed(1)}%
                            </div>
                            <div style="font-size: 1em; color: #34495e; font-weight: 600; margin-bottom: 3px;">
                                ğŸ’µ ${formatNumber(result.annualRent)}
                            </div>
                            <div style="font-size: 0.8em; color: #7f8c8d; font-style: italic;">
                                Ø¯Ø®Ù„ Ø³Ù†ÙˆÙŠ
                            </div>
                            ${result.recommendation === 'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±' ? winnerBadge : ''}
                        </td>
                        
                        <td class="${hotelClass}" style="text-align: center; padding: 15px; ${hotelStyle} vertical-align: middle;">
                            <div style="font-size: 1.4em; font-weight: bold; color: #e67e22; margin-bottom: 5px;">
                                ğŸ“Š ${result.hotelROI.toFixed(1)}%
                            </div>
                            <div style="font-size: 1em; color: #34495e; font-weight: 600; margin-bottom: 3px;">
                                ğŸ’¸ ${formatNumber(result.hotelNetIncome)}
                            </div>
                            <div style="font-size: 0.8em; color: #7f8c8d; font-style: italic;">
                                Ø¯Ø®Ù„ ØµØ§ÙÙŠ
                            </div>
                            ${result.recommendation === 'Ø§Ù„ÙÙ†Ø¯Ù‚' ? winnerBadge : ''}
                        </td>
                        
                        <td class="${recommendationClass}" style="text-align: center; font-weight: bold; font-size: 1.1em; padding: 20px; background: linear-gradient(135deg, rgba(142, 68, 173, 0.1), rgba(155, 89, 182, 0.1)); border: 3px solid #8e44ad; vertical-align: middle;">
                            <div style="font-size: 2em; margin-bottom: 8px;">${recommendationIcon}</div>
                            <div style="color: #8e44ad; font-weight: bold; font-size: 1.1em; margin-bottom: 5px;">${recommendationText}</div>
                            <div style="font-size: 1.1em; color: #27ae60; font-weight: bold; background: rgba(39, 174, 96, 0.1); padding: 4px 8px; border-radius: 8px;">
                                â­ ${result.bestROIValue.toFixed(1)}%
                            </div>
                            <div style="font-size: 0.8em; color: #e74c3c; font-weight: bold; margin-top: 5px;">
                                Ø§Ù„Ø£ÙØ¶Ù„
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        async function calculate() {
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('summaryCards').style.display = 'none';

            await new Promise(resolve => setTimeout(resolve, 500));

            // Get input values
            const landArea = parseFloat(document.getElementById('landArea').value) || 0;
            const landCost = parseFloat(document.getElementById('landCost').value) || 0;
            const buildRatio = (parseFloat(document.getElementById('buildRatio').value) || 0) / 100;
            const buildCost = parseFloat(document.getElementById('buildCost').value) || 0;
            const hotelBuildCost = parseFloat(document.getElementById('hotelBuildCost').value) || 0;
            const apartmentSize = parseFloat(document.getElementById('apartmentSize').value) || 1;
            const sellPrice = parseFloat(document.getElementById('sellPrice').value) || 0;
            const rentPrice = parseFloat(document.getElementById('rentPrice').value) || 0;
            const occupancyRate = (parseFloat(document.getElementById('occupancyRate').value) || 100) / 100;
            const roomSize = parseFloat(document.getElementById('roomSize').value) || 25;
            const roomRate = parseFloat(document.getElementById('roomRate').value) || 0;
            const hotelOccupancy = (parseFloat(document.getElementById('hotelOccupancy').value) || 75) / 100;
            const operatingCosts = (parseFloat(document.getElementById('operatingCosts').value) || 40) / 100;
            const buildingDepreciation = (parseFloat(document.getElementById('buildingDepreciation').value) || 3) / 100;
            const landRent = (parseFloat(document.getElementById('landRent').value) || 5) / 100;
            const minFloors = parseInt(document.getElementById('minFloors').value) || 1;
            const maxFloors = parseInt(document.getElementById('maxFloors').value) || 1;

            if (minFloors > maxFloors) {
                alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø£Ø¯ÙˆØ§Ø± Ø£Ù‚Ù„ Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù„Ù‰');
                document.getElementById('loading').style.display = 'none';
                return;
            }

            // Clear previous results
            calculationResults = {
                sale: [],
                rental: [],
                hotel: [],
                comparison: []
            };

            for (let floors = minFloors; floors <= maxFloors; floors++) {
                const totalBuildArea = landArea * buildRatio * floors;
                const numApts = Math.floor(totalBuildArea / apartmentSize);
                const totalLandCost = landArea * landCost;
                
                // Separate building costs for apartments vs hotel
                const totalBuildCostApts = totalBuildArea * buildCost;
                const totalBuildCostHotel = totalBuildArea * hotelBuildCost;
                
                const totalCostApts = totalLandCost + totalBuildCostApts;
                const totalCostHotel = totalLandCost + totalBuildCostHotel;

                // Sale calculations
                const saleRevenue = totalBuildArea * sellPrice;
                const saleProfit = saleRevenue - totalCostApts;
                const saleROI = totalCostApts > 0 ? (saleProfit / totalCostApts) * 100 : 0;
                const breakeven = totalBuildArea > 0 ? totalCostApts / totalBuildArea : 0;

                // Rental calculations
                const annualRentPerApt = apartmentSize * rentPrice * occupancyRate;
                const totalAnnualRent = numApts * annualRentPerApt;
                const totalMonthlyRent = totalAnnualRent / 12;
                const rentalROI = totalCostApts > 0 ? (totalAnnualRent / totalCostApts) * 100 : 0;
                const rentalPaybackPeriod = totalAnnualRent > 0 ? totalCostApts / totalAnnualRent : Infinity;

                // Hotel calculations (using hotel-specific costs)
                const numRooms = Math.floor(totalBuildArea / roomSize);
                const grossHotelRevenue = numRooms * roomRate * 365 * hotelOccupancy;
                
                // Calculate all hotel costs
                const operatingCostsAmount = grossHotelRevenue * operatingCosts;
                const depreciationAmount = totalBuildCostHotel * buildingDepreciation;
                const landRentAmount = totalLandCost * landRent;
                const totalHotelCosts = operatingCostsAmount + depreciationAmount + landRentAmount;
                
                const netHotelIncome = grossHotelRevenue - totalHotelCosts;
                const hotelROI = totalCostHotel > 0 ? (netHotelIncome / totalCostHotel) * 100 : 0;
                const hotelPaybackPeriod = netHotelIncome > 0 ? totalCostHotel / netHotelIncome : Infinity;

                // Store results
                calculationResults.sale.push({
                    floors, totalBuildArea, numApts, totalCost: totalCostApts,
                    revenue: saleRevenue, profit: saleProfit, roi: saleROI, breakeven
                });

                calculationResults.rental.push({
                    floors, totalBuildArea, numApts, totalCost: totalCostApts,
                    monthlyIncome: totalMonthlyRent, annualIncome: totalAnnualRent,
                    roi: rentalROI, paybackPeriod: rentalPaybackPeriod
                });

                calculationResults.hotel.push({
                    floors, totalBuildArea, numRooms, totalCost: totalCostHotel,
                    grossRevenue: grossHotelRevenue, 
                    operatingCosts: operatingCostsAmount,
                    depreciation: depreciationAmount,
                    landRentCost: landRentAmount,
                    totalCosts: totalHotelCosts,
                    netIncome: netHotelIncome, roi: hotelROI, paybackPeriod: hotelPaybackPeriod
                });

                // Comparison data - Compare all three strategies
                let bestStrategy = 'Ø§Ù„Ø¨ÙŠØ¹';
                let bestROI = saleROI;
                
                if (rentalROI > bestROI) {
                    bestStrategy = 'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±';
                    bestROI = rentalROI;
                }
                
                if (hotelROI > bestROI) {
                    bestStrategy = 'Ø§Ù„ÙÙ†Ø¯Ù‚';
                    bestROI = hotelROI;
                }
                
                calculationResults.comparison.push({
                    floors, 
                    saleROI, 
                    rentalROI, 
                    hotelROI, 
                    saleProfit, 
                    annualRent: totalAnnualRent, 
                    hotelNetIncome: netHotelIncome,
                    saleCost: totalCostApts,
                    rentalCost: totalCostApts,
                    hotelCost: totalCostHotel,
                    recommendation: bestStrategy,
                    bestROIValue: bestROI
                });
            }

            // Hide loading and show results
            document.getElementById('loading').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('summaryCards').style.display = 'grid';
            
            // Update display for current tab
            updateDisplay();
        }

        function exportToCSV() {
            const results = calculationResults[currentTab];
            if (!results || results.length === 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            let csv = '';
            
            if (currentTab === 'sale') {
                csv = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±,Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ (Ù…Â²),Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚,Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ (Ø±ÙŠØ§Ù„),Ø§Ù„Ø±Ø¨Ø­ (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± (%),Ø³Ø¹Ø± Ø§Ù„ØªØ¹Ø§Ø¯Ù„ Ù„Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„)\n';
                results.forEach(result => {
                    csv += `${result.floors},${result.totalBuildArea},${result.numApts},${result.totalCost},${result.revenue},${result.profit},${result.roi.toFixed(2)},${result.breakeven.toFixed(2)}\n`;
                });
            } else if (currentTab === 'rental') {
                csv = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±,Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ (Ù…Â²),Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚,Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ (%),ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ (Ø³Ù†Ø©)\n';
                results.forEach(result => {
                    csv += `${result.floors},${result.totalBuildArea},${result.numApts},${result.totalCost},${result.monthlyIncome},${result.annualIncome},${result.roi.toFixed(2)},${result.paybackPeriod === Infinity ? 'âˆ' : result.paybackPeriod.toFixed(1)}\n`;
                });
            } else if (currentTab === 'hotel') {
                csv = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±,Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ (Ù…Â²),Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù,Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„),Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¥Ù‡Ù„Ø§Ùƒ (Ø±ÙŠØ§Ù„),Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø£Ø±Ø¶ (Ø±ÙŠØ§Ù„),Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„ØµØ§ÙÙŠ (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ØµØ§ÙÙŠ (%),ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ (Ø³Ù†Ø©)\n';
                results.forEach(result => {
                    csv += `${result.floors},${result.totalBuildArea},${result.numRooms},${result.totalCost},${result.grossRevenue},${result.operatingCosts},${result.depreciation},${result.landRentCost},${result.totalCosts},${result.netIncome},${result.roi.toFixed(2)},${result.paybackPeriod === Infinity ? 'âˆ' : result.paybackPeriod.toFixed(1)}\n`;
                });
            } else {
                csv = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±,Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¨ÙŠØ¹ (%),Ø±Ø¨Ø­ Ø§Ù„Ø¨ÙŠØ¹ (Ø±ÙŠØ§Ù„),Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± (%),Ø¯Ø®Ù„ Ø¥ÙŠØ¬Ø§Ø± Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„),Ø¹Ø§Ø¦Ø¯ Ø§Ù„ÙÙ†Ø¯Ù‚ (%),Ø¯Ø®Ù„ ÙÙ†Ø¯Ù‚ ØµØ§ÙÙŠ (Ø±ÙŠØ§Ù„),Ø£ÙØ¶Ù„ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©,Ø£ÙØ¶Ù„ Ø¹Ø§Ø¦Ø¯ (%)\n';
                results.forEach(result => {
                    csv += `${result.floors},${result.saleROI.toFixed(2)},${result.saleProfit},${result.rentalROI.toFixed(2)},${result.annualRent},${result.hotelROI.toFixed(2)},${result.hotelNetIncome},${result.recommendation},${result.bestROIValue.toFixed(2)}\n`;
                });
            }

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Ù†ØªØ§Ø¦Ø¬_Ø­Ø§Ø³Ø¨Ø©_Ø§Ù„Ø¹Ø§Ø¦Ø¯_Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ_${currentTab}.csv`;
            link.click();
        }

        function exportToPDF() {
            window.print();
        }

        function copyToClipboard() {
            const results = calculationResults[currentTab];
            if (!results || results.length === 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            let text = `Ù†ØªØ§Ø¦Ø¬ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ - ${currentTab === 'sale' ? 'Ø§Ù„Ø¨ÙŠØ¹' : currentTab === 'rental' ? 'Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±' : currentTab === 'hotel' ? 'Ø§Ù„ÙÙ†Ø¯Ù‚' : 'Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©'}\n\n`;
            
            if (currentTab === 'sale') {
                text += 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±\tÙ…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡\tØ¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚\tØ§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ©\tØ§Ù„Ø¥ÙŠØ±Ø§Ø¯\tØ§Ù„Ø±Ø¨Ø­\tØ§Ù„Ø¹Ø§Ø¦Ø¯\tØ³Ø¹Ø± Ø§Ù„ØªØ¹Ø§Ø¯Ù„\n';
                results.forEach(result => {
                    text += `${result.floors}\t${formatNumber(result.totalBuildArea)}\t${result.numApts}\t${formatNumber(result.totalCost)}\t${formatNumber(result.revenue)}\t${formatNumber(result.profit)}\t${result.roi.toFixed(2)}%\t${formatNumber(result.breakeven)}\n`;
                });
            } else if (currentTab === 'rental') {
                text += 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±\tÙ…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡\tØ¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚\tØ§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ©\tØ§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ\tØ§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ\tØ§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ\tÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯\n';
                results.forEach(result => {
                    text += `${result.floors}\t${formatNumber(result.totalBuildArea)}\t${result.numApts}\t${formatNumber(result.totalCost)}\t${formatNumber(result.monthlyIncome)}\t${formatNumber(result.annualIncome)}\t${result.roi.toFixed(2)}%\t${result.paybackPeriod === Infinity ? 'âˆ' : result.paybackPeriod.toFixed(1)}\n`;
                });
            } else if (currentTab === 'hotel') {
                text += 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±\tÙ…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡\tØ¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù\tØ§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ©\tØ§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ\tØ§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©\tØ§Ù„Ø¥Ù‡Ù„Ø§Ùƒ\tØ¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø£Ø±Ø¶\tØ¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ\tØ§Ù„Ø¯Ø®Ù„ Ø§Ù„ØµØ§ÙÙŠ\tØ§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ØµØ§ÙÙŠ\tÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯\n';
                results.forEach(result => {
                    text += `${result.floors}\t${formatNumber(result.totalBuildArea)}\t${result.numRooms}\t${formatNumber(result.totalCost)}\t${formatNumber(result.grossRevenue)}\t${formatNumber(result.operatingCosts)}\t${formatNumber(result.depreciation)}\t${formatNumber(result.landRentCost)}\t${formatNumber(result.totalCosts)}\t${formatNumber(result.netIncome)}\t${result.roi.toFixed(2)}%\t${result.paybackPeriod === Infinity ? 'âˆ' : result.paybackPeriod.toFixed(1)}\n`;
                });
            } else {
                text += 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±\tØ¹Ø§Ø¦Ø¯ Ø§Ù„Ø¨ÙŠØ¹\tØ¹Ø§Ø¦Ø¯ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±\tØ¹Ø§Ø¦Ø¯ Ø§Ù„ÙÙ†Ø¯Ù‚\tØ±Ø¨Ø­ Ø§Ù„Ø¨ÙŠØ¹\tØ¯Ø®Ù„ Ø¥ÙŠØ¬Ø§Ø± Ø³Ù†ÙˆÙŠ\tØ¯Ø®Ù„ ÙÙ†Ø¯Ù‚ ØµØ§ÙÙŠ\tØ§Ù„ØªÙˆØµÙŠØ©\n';
                results.forEach(result => {
                    text += `${result.floors}\t${result.saleROI.toFixed(2)}%\t${result.rentalROI.toFixed(2)}%\t${result.hotelROI.toFixed(2)}%\t${formatNumber(result.saleProfit)}\t${formatNumber(result.annualRent)}\t${formatNumber(result.hotelNetIncome)}\t${result.recommendation}\n`;
                });
            }

            navigator.clipboard.writeText(text).then(() => {
                alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
            });
        }

        // Add input validation
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', function() {
                if (this.value < 0) this.value = 0;
                if (this.id === 'buildRatio' && this.value > 100) this.value = 100;
                if (this.id === 'occupancyRate' && this.value > 100) this.value = 100;
                if (this.id === 'hotelOccupancy' && this.value > 100) this.value = 100;
                if (this.id === 'operatingCosts' && this.value > 100) this.value = 100;
                if (this.id === 'buildingDepreciation' && this.value > 10) this.value = 10;
                if (this.id === 'landRent' && this.value > 20) this.value = 20;
            });
        });

        // Auto-calculate on input change (with debounce)
        let debounceTimer;
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', function() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    if (document.getElementById('resultsContainer').style.display !== 'none') {
                        calculate();
                    }
                }, 1000);
            });
        });

        // Calculate on page load
        window.addEventListener('load', calculate);

        // Print styles
        const printStyles = `
            <style media="print">
                body { background: white !important; }
                .container { box-shadow: none !important; background: white !important; }
                .export-buttons { display: none !important; }
                .calculate-btn { display: none !important; }
                .inputs-grid { display: none !important; }
                .tabs { display: none !important; }
                h1 { color: black !important; -webkit-text-fill-color: black !important; }
                .results-table { box-shadow: none !important; }
                .summary-card { border: 1px solid #ccc !important; }
            </style>
        `;
        document.head.insertAdjacentHTML('beforeend', printStyles);
    </script>
</body>
</html>