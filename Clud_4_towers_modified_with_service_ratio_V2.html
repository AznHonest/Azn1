<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - 4 Ø£Ø¨Ø±Ø§Ø¬ Ø¹Ù„Ù‰ Ø£Ø±Ø¶ ÙˆØ§Ø­Ø¯Ø©</title>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .project-overview {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #667eea;
        }

        .towers-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
            position: relative;
        }

        .tower-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 3px solid;
            transition: all 0.3s ease;
            text-align: center;
        }

        .tower-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .tower-sale-1 { border-color: #3498db; }
        .tower-sale-2 { border-color: #2980b9; }
        .tower-rental { border-color: #27ae60; }
        .tower-hotel { border-color: #e67e22; }

        .tower-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .tower-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .shared-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            z-index: 10;
        }

        .inputs-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .towers-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .tower-inputs {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid;
        }

        .tower-inputs.sale1 { border-color: #3498db; }
        .tower-inputs.sale2 { border-color: #2980b9; }
        .tower-inputs.rental { border-color: #27ae60; }
        .tower-inputs.hotel { border-color: #e67e22; }

        .input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            direction: ltr;
            text-align: center;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .calculate-btn {
            display: block;
            width: 250px;
            margin: 30px auto;
            padding: 18px 35px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-container {
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.2);
        }

        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .summary-card .value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #667eea;
        }

        .towers-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .tower-result {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .tower-result.sale1 { border-color: #3498db; }
        .tower-result.sale2 { border-color: #2980b9; }
        .tower-result.rental { border-color: #27ae60; }
        .tower-result.hotel { border-color: #e67e22; }

        .tower-result h3 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: #2c3e50;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #555;
        }

        .result-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .profit-positive { color: #27ae60; }
        .profit-negative { color: #e74c3c; }

        .total-investment {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
        }

        .total-investment h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .total-investment .amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .best-tower {
            border: 4px solid #f39c12 !important;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3) !important;
            position: relative;
        }

        .best-tower::before {
            content: "ğŸ† Ø§Ù„Ø£ÙØ¶Ù„";
            position: absolute;
            top: -10px;
            right: 15px;
            background: #f39c12;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .shared-costs-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #667eea;
        }

        .export-buttons {
            margin-top: 20px;
            text-align: center;
            gap: 10px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 12px 25px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .export-btn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
            text-align: center;
        }

        @media (max-width: 1200px) {
            .towers-inputs-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .towers-layout {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(4, 1fr);
            }

            .shared-area {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                margin: 20px auto;
            }

            .towers-inputs-grid {
                grid-template-columns: 1fr;
            }

            .inputs-grid {
                grid-template-columns: 1fr;
            }

            .towers-results {
                grid-template-columns: 1fr;
            }
        }
</style>
</head>
<body>
<div class="container">
<h1>ğŸ¢ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - 4 Ø£Ø¨Ø±Ø§Ø¬ Ø¹Ù„Ù‰ Ø£Ø±Ø¶ ÙˆØ§Ø­Ø¯Ø©</h1>
<div class="project-overview">
<h2 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h2>
<div class="towers-layout">
<div class="tower-card tower-sale-1">
<div class="tower-icon">ğŸ¢</div>
<div class="tower-title">Ø¨Ø±Ø¬ Ø´Ù‚Ù‚ Ù„Ù„Ø¨ÙŠØ¹ #1</div>
<p>Ø´Ù‚Ù‚ Ø³ÙƒÙ†ÙŠØ© Ù…ØªÙ†ÙˆØ¹Ø© Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª</p>
</div>
<div class="tower-card tower-sale-2">
<div class="tower-icon">ğŸ˜ï¸</div>
<div class="tower-title">Ø¨Ø±Ø¬ Ø´Ù‚Ù‚ Ù„Ù„Ø¨ÙŠØ¹ #2</div>
<p>Ø´Ù‚Ù‚ Ø³ÙƒÙ†ÙŠØ© ÙØ§Ø®Ø±Ø©</p>
</div>
<div class="tower-card tower-rental">
<div class="tower-icon">ğŸ </div>
<div class="tower-title">Ø¨Ø±Ø¬ Ù…ÙƒØ§ØªØ¨ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</div>
<p>Ù…ÙƒØ§ØªØ¨ ØªØ¬Ø§Ø±ÙŠØ© ÙˆØ¥Ø¯Ø§Ø±ÙŠØ©</p>
</div>
<div class="tower-card tower-hotel">
<div class="tower-icon">ğŸ¨</div>
<div class="tower-title">Ø¨Ø±Ø¬ ÙÙ†Ø¯Ù‚ Ù„Ù„ØªØ´ØºÙŠÙ„</div>
<p>ÙÙ†Ø¯Ù‚ ÙˆØ®Ø¯Ù…Ø§Øª Ø¶ÙŠØ§ÙØ©</p>
</div>
<div class="shared-area">
                ğŸŒ³ Ù…Ù†Ø·Ù‚Ø© Ù…Ø´ØªØ±ÙƒØ©<br/>
                ÙˆÙ…Ø±Ø§ÙÙ‚ Ø¹Ø§Ù…Ø©
            </div>
</div>
</div>
<div class="shared-costs-section">
<h3 class="section-title">ğŸï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©</h3>
<div class="inputs-grid">
<div class="input-group">
<label for="totalLandArea">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø£Ø±Ø¶ (Ù…Â²)</label>
<input id="totalLandArea" min="0" step="100" type="number" value="18600"/>
</div>
<div class="input-group">
<label for="landCostPerMeter">Ø³Ø¹Ø± Ù…ØªØ± Ø§Ù„Ø£Ø±Ø¶ (Ø±ÙŠØ§Ù„)</label>
<input id="landCostPerMeter" min="0" step="100" type="number" value="12000"/>
</div>
<div class="input-group">
<label for="sharedAreaRatio">Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (%)</label>
<input id="sharedAreaRatio" max="50" min="0" step="1" type="number" value="15"/>
</div>
<div class="input-group">
<label for="sharedAreaCost">ØªÙƒÙ„ÙØ© ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø±ÙŠØ§Ù„/Ù…Â²)</label>
<input id="sharedAreaCost" min="0" step="100" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="infrastructureCost">ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ø±ÙŠØ§Ù„)</label>
<input id="infrastructureCost" min="0" step="100000" type="number" value="5000000"/>
</div>
<div class="input-group">
<label for="designAndPlanningCost">ØªÙƒÙ„ÙØ© Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„ØªØ®Ø·ÙŠØ· (Ø±ÙŠØ§Ù„)</label>
<input id="designAndPlanningCost" min="0" step="50000" type="number" value="2000000"/>
</div>
</div>
</div>
<div class="towers-inputs-grid">
<div class="tower-inputs sale1">
<h3 class="section-title">ğŸ¢ Ø¨Ø±Ø¬ Ø´Ù‚Ù‚ Ù„Ù„Ø¨ÙŠØ¹ #1</h3>
<div class="input-group">
<label for="sale1Floors">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</label>
<input id="sale1Floors" min="1" step="1" type="number" value="10"/>
</div>
<div class="input-group">
<label for="sale1FloorArea">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ§Ø­Ø¯ (Ù…Â²)</label>
<input id="sale1FloorArea" min="0" step="50" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="sale1ApartmentSize">Ù…ØªÙˆØ³Ø· Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø´Ù‚Ø© (Ù…Â²)</label>
<input id="sale1ApartmentSize" min="1" step="10" type="number" value="140"/>
</div>
<div class="input-group">
<label for="sale1BuildCost">ØªÙƒÙ„ÙØ© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„)</label>
<input id="sale1BuildCost" min="0" step="50" type="number" value="4500"/>
</div>
<div class="input-group">
<label for="sale1SellPrice">Ø³Ø¹Ø± Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„)</label>
<input id="sale1SellPrice" min="0" step="100" type="number" value="8500"/>
</div>
</div>
<div class="tower-inputs sale2">
<h3 class="section-title">ğŸ˜ï¸ Ø¨Ø±Ø¬ Ø´Ù‚Ù‚ Ù„Ù„Ø¨ÙŠØ¹ #2</h3>
<div class="input-group">
<label for="sale2Floors">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</label>
<input id="sale2Floors" min="1" step="1" type="number" value="10"/>
</div>
<div class="input-group">
<label for="sale2FloorArea">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ§Ø­Ø¯ (Ù…Â²)</label>
<input id="sale2FloorArea" min="0" step="50" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="sale2ApartmentSize">Ù…ØªÙˆØ³Ø· Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø´Ù‚Ø© (Ù…Â²)</label>
<input id="sale2ApartmentSize" min="1" step="10" type="number" value="140"/>
</div>
<div class="input-group">
<label for="sale2BuildCost">ØªÙƒÙ„ÙØ© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„)</label>
<input id="sale2BuildCost" min="0" step="50" type="number" value="4500"/>
</div>
<div class="input-group">
<label for="sale2SellPrice">Ø³Ø¹Ø± Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„)</label>
<input id="sale2SellPrice" min="0" step="100" type="number" value="8500"/>
</div>
</div>
<div class="tower-inputs rental">
<h3 class="section-title">ğŸ  Ø¨Ø±Ø¬ Ù…ÙƒØ§ØªØ¨ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</h3>
<div class="input-group">
<label for="rentalFloors">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</label>
<input id="rentalFloors" min="1" step="1" type="number" value="10"/>
</div>
<div class="input-group">
<label for="rentalFloorArea">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ§Ø­Ø¯ (Ù…Â²)</label>
<input id="rentalFloorArea" min="0" step="50" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="rentalOfficeSize">Ù…ØªÙˆØ³Ø· Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ÙƒØªØ¨ (Ù…Â²)</label>
<input id="rentalOfficeSize" min="1" step="10" type="number" value="300"/>
</div>
<div class="input-group">
<label for="rentalBuildCost">ØªÙƒÙ„ÙØ© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„)</label>
<input id="rentalBuildCost" min="0" step="50" type="number" value="5000"/>
</div>
<div class="input-group">
<label for="rentalPricePerMeter">Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ù…ØªØ± Ø³Ù†ÙˆÙŠØ§Ù‹ (Ø±ÙŠØ§Ù„)</label>
<input id="rentalPricePerMeter" min="0" step="10" type="number" value="1200"/>
</div>
<div class="input-group">
<label for="rentalOccupancyRate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø´ØºØ§Ù„ (%)</label>
<input id="rentalOccupancyRate" max="100" min="0" step="1" type="number" value="80"/>
</div>
</div>
<div class="tower-inputs hotel">
<h3 class="section-title">ğŸ¨ Ø¨Ø±Ø¬ ÙÙ†Ø¯Ù‚ Ù„Ù„ØªØ´ØºÙŠÙ„</h3>
<div class="input-group">
<label for="hotelFloors">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</label>
<input id="hotelFloors" min="1" step="1" type="number" value="10"/>
</div>
<div class="input-group">
<label for="hotelFloorArea">Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ§Ø­Ø¯ (Ù…Â²)</label>
<input id="hotelFloorArea" min="0" step="50" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="hotelRoomSize">Ù…ØªÙˆØ³Ø· Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØºØ±ÙØ© (Ù…Â²)</label>
<input id="hotelRoomSize" min="1" step="5" type="number" value="70"/>
</div>
<div class="input-group">
<label for="hotelBuildCost">ØªÙƒÙ„ÙØ© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ØªØ± (Ø±ÙŠØ§Ù„)</label>
<input id="hotelBuildCost" min="0" step="50" type="number" value="6500"/>
</div>
<div class="input-group">
<label for="hotelRoomRate">Ø³Ø¹Ø± Ø§Ù„ØºØ±ÙØ©/Ù„ÙŠÙ„Ø© (Ø±ÙŠØ§Ù„)</label>
<input id="hotelRoomRate" min="0" step="10" type="number" value="650"/>
</div>
<div class="input-group">
<label for="hotelOccupancyRate">Ù…Ø¹Ø¯Ù„ Ø¥Ø´ØºØ§Ù„ Ø§Ù„ÙÙ†Ø¯Ù‚ (%)</label>
<input id="hotelOccupancyRate" max="100" min="0" step="1" type="number" value="70"/>
</div>
<div class="input-group">
<label for="hotelOperatingCosts">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© (%)</label>
<input id="hotelOperatingCosts" max="100" min="0" step="1" type="number" value="30"/>
</div>

<div class="input-group">
<label for="hotelOperationalAreaRatio">Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© (%)</label>
<input id="hotelOperationalAreaRatio" max="50" min="0" step="1" type="number" value="25"/>
</div>
<div class="input-group">
<label for="hotelServiceRatio">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ù† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ (%)</label>
<input id="hotelServiceRatio" max="100" min="0" step="1" type="number" value="5"/>
</div>
</div>
</div>
<div class="inputs-section">
<h3 class="section-title">ğŸ’³ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„</h3>
<div class="inputs-grid">
<div class="input-group">
<label for="loanRatio">Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ© (%)</label>
<input id="loanRatio" max="100" min="0" step="1" type="number" value="0"/>
</div>
<div class="input-group">
<label for="loanYears">Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø³Ù†Ø©)</label>
<input id="loanYears" min="1" step="1" type="number" value="0"/>
</div>
<div class="input-group">
<label for="interestRate">Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© (%)</label>
<input id="interestRate" min="0" step="0.1" type="number" value="0"/>
</div>
</div>
</div>
<button class="calculate-btn" onclick="calculateProject()">ğŸ”„ Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø¬Ù…Ø¹</button>
<div class="loading" id="loading">
<div class="spinner"></div>
<p>Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹ÙˆØ§Ø¦Ø¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©...</p>
</div>
<div class="error-message" id="errorMessage" style="display: none;"></div>
<div id="resultsSection" style="display: none;">
<div class="total-investment" id="totalInvestment">
<h2>ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</h2>
<div class="amount" id="totalInvestmentAmount">0 Ø±ÙŠØ§Ù„</div>
<p>Ø´Ø§Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ ÙˆØ§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©</p>
</div>
<div class="summary-cards" id="summaryCards">
<div class="summary-card">
<h3>ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ</h3>
<div class="value" id="totalAnnualReturn">0%</div>
</div>
<div class="summary-card">
<h3>ğŸ’µ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</h3>
<div class="value" id="totalAnnualIncome">0 Ø±ÙŠØ§Ù„</div>
</div>
<div class="summary-card">
<h3>ğŸ† Ø£ÙØ¶Ù„ Ø¨Ø±Ø¬ (Ø¹Ø§Ø¦Ø¯)</h3>
<div class="value" id="bestTowerROI">-</div>
</div>
<div class="summary-card">
<h3>ğŸ’ Ø£Ø¹Ù„Ù‰ Ø¯Ø®Ù„ (Ø¨Ø±Ø¬)</h3>
<div class="value" id="highestIncomeTower">-</div>
</div>
<div class="summary-card">
<h3>â±ï¸ ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</h3>
<div class="value" id="paybackPeriod">0 Ø³Ù†Ø©</div>
</div>
</div>
<div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
<h4 style="color: #1976d2; margin-bottom: 10px;">ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</h4>
<p style="color: #424242; font-size: 0.9rem;">
                ğŸ“Š <strong>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</strong> ØªØ´Ù…Ù„: 
                ğŸï¸ <strong>ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶</strong> + 
                ğŸ—ï¸ <strong>ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†Ø§Ø¡</strong> + 
                ğŸŒ³ <strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©</strong> + 
                ğŸš§ <strong>Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©</strong>
</p>
</div>
<div class="towers-results" id="towersResults">
<div class="tower-result sale1" id="sale1Results">
<h3>ğŸ¢ Ø¨Ø±Ø¬ Ø´Ù‚Ù‚ Ù„Ù„Ø¨ÙŠØ¹ #1</h3>
<div class="result-item">
<span class="result-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</span>
<span class="result-value" id="sale1TotalArea">0 Ù…Â²</span>
</div>
<div class="result-item">
<span class="result-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚:</span>
<span class="result-value" id="sale1Units">0</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">ğŸï¸ ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶ (Ø­ØµØ© Ø§Ù„Ø¨Ø±Ø¬):</span>
<span class="result-value" id="sale1LandCost">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¶ Ù…Ù† Ø§Ù„ØªÙƒÙ„ÙØ©:</span>
<span class="result-value" id="sale1LandRatio">0%</span>
</div>
<div class="result-item">
<span class="result-label">ğŸ—ï¸ ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙÙ‚Ø·:</span>
<span class="result-value" id="sale1BuildCostResult">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item" style="background: rgba(108, 117, 125, 0.1); font-weight: bold;">
<span class="result-label">ğŸ“Š Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</span>
<span class="result-value" id="sale1TotalCost">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</span>
<span class="result-value profit-positive" id="sale1Revenue">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­:</span>
<span class="result-value" id="sale1Profit">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±:</span>
<span class="result-value" id="sale1ROI">0%</span>
</div>
</div>
<div class="tower-result sale2" id="sale2Results">
<h3>ğŸ˜ï¸ Ø¨Ø±Ø¬ Ø´Ù‚Ù‚ Ù„Ù„Ø¨ÙŠØ¹ #2</h3>
<div class="result-item">
<span class="result-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</span>
<span class="result-value" id="sale2TotalArea">0 Ù…Â²</span>
</div>
<div class="result-item">
<span class="result-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚:</span>
<span class="result-value" id="sale2Units">0</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">ğŸï¸ ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶ (Ø­ØµØ© Ø§Ù„Ø¨Ø±Ø¬):</span>
<span class="result-value" id="sale2LandCost">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¶ Ù…Ù† Ø§Ù„ØªÙƒÙ„ÙØ©:</span>
<span class="result-value" id="sale2LandRatio">0%</span>
</div>
<div class="result-item">
<span class="result-label">ğŸ—ï¸ ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙÙ‚Ø·:</span>
<span class="result-value" id="sale2BuildCostResult">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item" style="background: rgba(108, 117, 125, 0.1); font-weight: bold;">
<span class="result-label">ğŸ“Š Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</span>
<span class="result-value" id="sale2TotalCost">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</span>
<span class="result-value profit-positive" id="sale2Revenue">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­:</span>
<span class="result-value" id="sale2Profit">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±:</span>
<span class="result-value" id="sale2ROI">0%</span>
</div>
</div>
<div class="tower-result rental" id="rentalResults">
<h3>ğŸ  Ø¨Ø±Ø¬ Ù…ÙƒØ§ØªØ¨ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</h3>
<div class="result-item">
<span class="result-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</span>
<span class="result-value" id="rentalTotalArea">0 Ù…Â²</span>
</div>
<div class="result-item">
<span class="result-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙƒØ§ØªØ¨:</span>
<span class="result-value" id="rentalUnits">0</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">ğŸï¸ ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶ (Ø­ØµØ© Ø§Ù„Ø¨Ø±Ø¬):</span>
<span class="result-value" id="rentalLandCost">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¶ Ù…Ù† Ø§Ù„ØªÙƒÙ„ÙØ©:</span>
<span class="result-value" id="rentalLandRatio">0%</span>
</div>
<div class="result-item">
<span class="result-label">ğŸ—ï¸ ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙÙ‚Ø·:</span>
<span class="result-value" id="rentalBuildCostResult">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item" style="background: rgba(108, 117, 125, 0.1); font-weight: bold;">
<span class="result-label">ğŸ“Š Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</span>
<span class="result-value" id="rentalTotalCost">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ:</span>
<span class="result-value profit-positive" id="rentalMonthlyIncome">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ:</span>
<span class="result-value profit-positive" id="rentalAnnualIncome">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ:</span>
<span class="result-value" id="rentalROI">0%</span>
</div>
<div class="result-item">
<span class="result-label">ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯:</span>
<span class="result-value" id="rentalPayback">0 Ø³Ù†Ø©</span>
</div>
</div>
<div class="tower-result hotel" id="hotelResults">
<h3>ğŸ¨ Ø¨Ø±Ø¬ ÙÙ†Ø¯Ù‚ Ù„Ù„ØªØ´ØºÙŠÙ„</h3>
<div class="result-item">
<span class="result-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</span>
<span class="result-value" id="hotelTotalArea">0 Ù…Â²</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">ğŸ”§ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©:</span>
<span class="result-value" id="hotelOperationalArea">0 Ù…Â²</span>
</div>
<div class="result-item" style="background: rgba(39, 174, 96, 0.1);">
<span class="result-label">ğŸ›ï¸ Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ØªØ§Ø­Ø©:</span>
<span class="result-value" id="hotelAvailableRoomArea">0 Ù…Â²</span>
</div>
<div class="result-item">
<span class="result-label">Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù:</span>
<span class="result-value" id="hotelRooms">0</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">ğŸï¸ ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶ (Ø­ØµØ© Ø§Ù„Ø¨Ø±Ø¬):</span>
<span class="result-value" id="hotelLandCost">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¶ Ù…Ù† Ø§Ù„ØªÙƒÙ„ÙØ©:</span>
<span class="result-value" id="hotelLandRatio">0%</span>
</div>
<div class="result-item">
<span class="result-label">ğŸ—ï¸ ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙÙ‚Ø·:</span>
<span class="result-value" id="hotelBuildCostResult">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item" style="background: rgba(108, 117, 125, 0.1); font-weight: bold;">
<span class="result-label">ğŸ“Š Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</span>
<span class="result-value" id="hotelTotalCost">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
<span class="result-value profit-positive" id="hotelGrossRevenue">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©:</span>
<span class="result-value profit-negative" id="hotelOperatingCostsAmount">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ:</span>
<span class="result-value" id="hotelNetIncome">0 Ø±ÙŠØ§Ù„</span>
</div>
<div class="result-item">
<span class="result-label">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ØµØ§ÙÙŠ:</span>
<span class="result-value" id="hotelROI">0%</span>
</div>
<div class="result-item">
<span class="result-label">ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯:</span>
<span class="result-value" id="hotelPayback">0 Ø³Ù†Ø©</span>
</div>
</div>
</div>
<div class="export-buttons">
<button class="export-btn" onclick="exportToCSV()">ğŸ“ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV</button>
<button class="export-btn" onclick="exportToPDF()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± PDF</button>
<button class="export-btn" onclick="generateDetailedReport()">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„</button>
<button class="export-btn" onclick="saveProject()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
</div>
</div>
</div>
<script>
    let projectData = {};

    function formatNumber(num) {
        if (isNaN(num) || !isFinite(num)) return '0';
        return new Intl.NumberFormat('en-US').format(Math.round(num));
    }

    function safeParseFloat(value, defaultValue = 0) {
        const parsed = parseFloat(value);
        return isNaN(parsed) ? defaultValue : parsed;
    }

    function safeParseInt(value, defaultValue = 0) {
        const parsed = parseInt(value);
        return isNaN(parsed) ? defaultValue : parsed;
    }

    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => {
            errorDiv.style.display = 'none';
        }, 5000);
    }

    function validateInputs() {
        // Basic validation
        const totalLandArea = safeParseFloat(document.getElementById('totalLandArea').value);
        const landCostPerMeter = safeParseFloat(document.getElementById('landCostPerMeter').value);
        
        if (totalLandArea <= 0) {
            throw new Error('Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø£Ø±Ø¶ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±');
        }
        
        if (landCostPerMeter <= 0) {
            throw new Error('Ø³Ø¹Ø± Ù…ØªØ± Ø§Ù„Ø£Ø±Ø¶ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±');
        }

        // Validate each tower
        const towers = ['sale1', 'sale2', 'rental', 'hotel'];
        for (let tower of towers) {
            const floors = safeParseInt(document.getElementById(`${tower}Floors`).value);
            const floorArea = safeParseFloat(document.getElementById(`${tower}FloorArea`).value);
            
            if (floors <= 0) {
                throw new Error(`Ø¹Ø¯Ø¯ Ø£Ø¯ÙˆØ§Ø± ${tower} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±`);
            }
            
            if (floorArea <= 0) {
                throw new Error(`Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯ÙˆØ± ${tower} ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±`);
            }
        }
        
        return true;
    }

    function calculateSharedCosts() {
        try {
            const totalLandArea = safeParseFloat(document.getElementById('totalLandArea').value);
            const landCostPerMeter = safeParseFloat(document.getElementById('landCostPerMeter').value);
            const sharedAreaRatio = safeParseFloat(document.getElementById('sharedAreaRatio').value) / 100;
            const sharedAreaCost = safeParseFloat(document.getElementById('sharedAreaCost').value);
            const infrastructureCost = safeParseFloat(document.getElementById('infrastructureCost').value);
            const designAndPlanningCost = safeParseFloat(document.getElementById('designAndPlanningCost').value);

            const totalLandCost = totalLandArea * landCostPerMeter;
            const sharedArea = totalLandArea * sharedAreaRatio;
            const buildableArea = totalLandArea - sharedArea;
            const sharedAreaDevelopmentCost = sharedArea * sharedAreaCost;
            
            const totalSharedCosts = totalLandCost + sharedAreaDevelopmentCost + infrastructureCost + designAndPlanningCost;
            
            console.log('Shared costs breakdown:', {
                totalLandArea,
                landCostPerMeter,
                totalLandCost,
                sharedAreaDevelopmentCost,
                infrastructureCost,
                designAndPlanningCost,
                totalSharedCosts,
                sharedCostPerTower: totalSharedCosts / 4
            });
            
            return {
                totalLandCost,
                sharedArea,
                buildableArea,
                sharedAreaDevelopmentCost,
                infrastructureCost,
                designAndPlanningCost,
                totalSharedCosts
            };
        } catch (error) {
            console.error('Error in calculateSharedCosts:', error);
            throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©');
        }
    }

    async function calculateProject() {
        try {
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';

            await new Promise(resolve => setTimeout(resolve, 500));

            // Validate inputs
            validateInputs();

            // Calculate shared costs
            const sharedCosts = calculateSharedCosts();
            const sharedCostPerTower = sharedCosts.totalSharedCosts / 4;

            // Sale Tower 1 Calculations
            const sale1 = calculateSaleTower('sale1', sharedCostPerTower);
            
            // Sale Tower 2 Calculations
            const sale2 = calculateSaleTower('sale2', sharedCostPerTower);

            // Rental Tower Calculations
            const rental = calculateRentalTower(sharedCostPerTower);

            // Hotel Tower Calculations
            const hotel = calculateHotelTower(sharedCostPerTower);

            // Calculate totals
            const totalInvestment = sale1.totalCost + sale2.totalCost + rental.totalCost + hotel.totalCost;
            
            // For annual income calculation: sale towers give one-time profit, rental and hotel give annual income
            const saleProfit = (sale1.profit || 0) + (sale2.profit || 0);
            const annualIncome = rental.annualRent + hotel.netIncome;
            const totalAnnualIncome = annualIncome; // Only recurring income
            
            const totalAnnualReturn = totalInvestment > 0 ? (totalAnnualIncome / totalInvestment) * 100 : 0;

            // Store data
            projectData = {
                sale1, sale2, rental, hotel,
                sharedCosts,
                totals: {
                    investment: totalInvestment,
                    annualIncome: totalAnnualIncome,
                    annualReturn: totalAnnualReturn,
                    saleProfit: saleProfit
                }
            };

            // Hide loading and show results
            document.getElementById('loading').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
            
            // Update display
            updateResults();

        } catch (error) {
            console.error('Error calculating project:', error);
            document.getElementById('loading').style.display = 'none';
            showError(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©.');
        }
    }

    function calculateSaleTower(towerType, sharedCostPerTower) {
        try {
            console.log(`ğŸ”¥ CALCULATING ${towerType.toUpperCase()} ğŸ”¥`);
            
            const floors = safeParseInt(document.getElementById(`${towerType}Floors`).value);
            const floorArea = safeParseFloat(document.getElementById(`${towerType}FloorArea`).value);
            const apartmentSize = safeParseFloat(document.getElementById(`${towerType}ApartmentSize`).value, 1);
            const buildCost = safeParseFloat(document.getElementById(`${towerType}BuildCost`).value);
            const sellPrice = safeParseFloat(document.getElementById(`${towerType}SellPrice`).value);

            console.log(`${towerType} inputs:`, { floors, floorArea, apartmentSize, buildCost, sellPrice });

            const totalArea = floorArea * floors;
            const units = Math.floor(totalArea / apartmentSize);
            const buildingCost = totalArea * buildCost;
            const totalCost = buildingCost + sharedCostPerTower;
            const revenue = totalArea * sellPrice;
            const profit = revenue - totalCost;
            const roi = totalCost > 0 ? (profit / totalCost) * 100 : 0;

            const result = {
                floors,
                floorArea,
                apartmentSize,
                buildCost,
                sellPrice,
                totalArea,
                units,
                buildingCost,
                totalCost,
                revenue,
                profit,
                roi
            };

            console.log(`ğŸ¯ ${towerType} FINAL RESULT:`, result);
            console.log(`ğŸ—ï¸ Building Cost Check: ${buildingCost} = ${totalArea} Ã— ${buildCost}`);

            return result;
        } catch (error) {
            console.error(`ğŸ’¥ ERROR calculating ${towerType}:`, error);
            throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ ${towerType}: ${error.message}`);
        }
    }

    function calculateRentalTower(sharedCostPerTower) {
        try {
            const floors = safeParseInt(document.getElementById('rentalFloors').value);
            const floorArea = safeParseFloat(document.getElementById('rentalFloorArea').value);
            const officeSize = safeParseFloat(document.getElementById('rentalOfficeSize').value, 1);
            const buildCost = safeParseFloat(document.getElementById('rentalBuildCost').value);
            const rentPerMeter = safeParseFloat(document.getElementById('rentalPricePerMeter').value);
            const occupancyRate = safeParseFloat(document.getElementById('rentalOccupancyRate').value) / 100;

            const totalArea = floorArea * floors;
            const units = Math.floor(totalArea / officeSize);
            const buildingCost = totalArea * buildCost;
            const totalCost = buildingCost + sharedCostPerTower;
            const annualRent = totalArea * rentPerMeter * Math.min(occupancyRate, 1);
            const monthlyIncome = annualRent / 12;
            const roi = totalCost > 0 ? (annualRent / totalCost) * 100 : 0;
            const paybackPeriod = annualRent > 0 ? totalCost / annualRent : Infinity;

            console.log('Rental tower detailed calculation:', {
                floors,
                floorArea,
                totalArea,
                buildCost,
                buildingCost,
                sharedCostPerTower,
                totalCost,
                annualRent,
                roi: roi.toFixed(2) + '%'
            });

            return {
                floors,
                floorArea,
                officeSize,
                buildCost,
                rentPerMeter,
                occupancyRate: occupancyRate * 100,
                totalArea,
                units,
                buildingCost,
                totalCost,
                annualRent,
                monthlyIncome,
                roi,
                paybackPeriod
            };
        } catch (error) {
            console.error('Error calculating rental tower:', error);
            throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø¨Ø±Ø¬ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±');
        }
    }

    function calculateHotelTower(sharedCostPerTower) {
        try {
            const floors = safeParseInt(document.getElementById('hotelFloors').value);
            const floorArea = safeParseFloat(document.getElementById('hotelFloorArea').value);
            const roomSize = safeParseFloat(document.getElementById('hotelRoomSize').value, 1);
            const buildCost = safeParseFloat(document.getElementById('hotelBuildCost').value);
            const roomRate = safeParseFloat(document.getElementById('hotelRoomRate').value);
            const occupancyRate = safeParseFloat(document.getElementById('hotelOccupancyRate').value) / 100;
            const operatingCostRatio = safeParseFloat(document.getElementById('hotelOperatingCosts').value) / 100;
            const operationalAreaRatio = safeParseFloat(document.getElementById('hotelOperationalAreaRatio').value) / 100;

            const totalArea = floorArea * floors;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù„Ù„ØºØ±Ù Ø¨Ø¹Ø¯ Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©
            const operationalArea = totalArea * operationalAreaRatio;
            const availableRoomArea = totalArea - operationalArea;
            const rooms = Math.floor(availableRoomArea / roomSize);
            
            const buildingCost = totalArea * buildCost;
            const totalCost = buildingCost + sharedCostPerTower;
            const grossRevenue = rooms * roomRate * 365 * Math.min(occupancyRate, 1);
            
            const serviceRatio = safeParseFloat(document.getElementById('hotelServiceRatio').value) / 100;
        
            const serviceCost = grossRevenue * serviceRatio;
            const operatingCosts = grossRevenue * operatingCostRatio + serviceCost;
        
            const netIncome = grossRevenue - operatingCosts;
            const roi = totalCost > 0 ? (netIncome / totalCost) * 100 : 0;
            const paybackPeriod = netIncome > 0 ? totalCost / netIncome : Infinity;

            console.log('Hotel tower detailed calculation:', {
                floors,
                floorArea,
                totalArea,
                operationalArea: operationalArea.toFixed(0),
                availableRoomArea: availableRoomArea.toFixed(0),
                roomSize,
                rooms,
                buildCost,
                buildingCost,
                sharedCostPerTower,
                totalCost,
                grossRevenue,
                operatingCosts,
                netIncome,
                roi: roi.toFixed(2) + '%'
            });

            return {
                floors,
                floorArea,
                roomSize,
                buildCost,
                roomRate,
                occupancyRate: occupancyRate * 100,
                operatingCostRatio: operatingCostRatio * 100,
                operationalAreaRatio: operationalAreaRatio * 100,
                totalArea,
                operationalArea,
                availableRoomArea,
                rooms,
                buildingCost,
                totalCost,
                grossRevenue,
                operatingCosts,
                netIncome,
                roi,
                paybackPeriod
            };
        } catch (error) {
            console.error('Error calculating hotel tower:', error);
            throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø¨Ø±Ø¬ Ø§Ù„ÙÙ†Ø¯Ù‚');
        }
    }

    function updateResults() {
        if (!projectData || Object.keys(projectData).length === 0) return;

        try {
            console.log('ğŸ”¥ FULL PROJECT DATA ğŸ”¥');
            console.log('Complete projectData:', JSON.stringify(projectData, null, 2));
            
            const { sale1, sale2, rental, hotel, totals } = projectData;

            // Log individual tower data
            console.log('Sale1 data:', sale1);
            console.log('Sale2 data:', sale2);
            console.log('Rental data:', rental);
            console.log('Hotel data:', hotel);

            // Update total investment
            document.getElementById('totalInvestmentAmount').textContent = formatNumber(totals.investment) + ' Ø±ÙŠØ§Ù„';

            // Update summary cards
            document.getElementById('totalAnnualReturn').textContent = totals.annualReturn.toFixed(2) + '%';
            document.getElementById('totalAnnualIncome').textContent = formatNumber(totals.annualIncome) + ' Ø±ÙŠØ§Ù„';

            // Find best tower by ROI
            const rois = [
                { name: 'Ø¨Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ¹ #1', value: sale1.roi },
                { name: 'Ø¨Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ¹ #2', value: sale2.roi },
                { name: 'Ø¨Ø±Ø¬ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±', value: rental.roi },
                { name: 'Ø¨Ø±Ø¬ Ø§Ù„ÙÙ†Ø¯Ù‚', value: hotel.roi }
            ];
            const bestROI = rois.reduce((prev, current) => (prev.value > current.value) ? prev : current);
            document.getElementById('bestTowerROI').textContent = bestROI.name + ' (' + bestROI.value.toFixed(1) + '%)';

            // Find highest income tower
            const incomes = [
                { name: 'Ø¨Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ¹ #1', value: sale1.profit || 0 },
                { name: 'Ø¨Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ¹ #2', value: sale2.profit || 0 },
                { name: 'Ø¨Ø±Ø¬ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±', value: rental.annualRent },
                { name: 'Ø¨Ø±Ø¬ Ø§Ù„ÙÙ†Ø¯Ù‚', value: hotel.netIncome }
            ];
            const highestIncome = incomes.reduce((prev, current) => (prev.value > current.value) ? prev : current);
            document.getElementById('highestIncomeTower').textContent = highestIncome.name;

            // Calculate average payback period
            const paybacks = [rental.paybackPeriod, hotel.paybackPeriod].filter(p => p !== Infinity && !isNaN(p));
            const avgPayback = paybacks.length > 0 ? paybacks.reduce((a, b) => a + b, 0) / paybacks.length : 0;
            document.getElementById('paybackPeriod').textContent = avgPayback > 0 ? avgPayback.toFixed(1) + ' Ø³Ù†Ø©' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            // Update individual tower results
            console.log('ğŸ¯ NOW UPDATING INDIVIDUAL TOWERS');
            updateTowerResults('sale1', sale1);
            updateTowerResults('sale2', sale2);
            updateTowerResults('rental', rental);
            updateTowerResults('hotel', hotel);

            // Highlight best tower
            highlightBestTower();

        } catch (error) {
            console.error('ğŸ’¥ Error updating results:', error);
            showError('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
        }
    }

    function updateTowerResults(towerType, data) {
        try {
            console.log(`ğŸ”¥ SIMPLE UPDATE ${towerType.toUpperCase()} ğŸ”¥`);
            
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            document.getElementById(`${towerType}TotalArea`).innerHTML = formatNumber(data.totalArea) + ' Ù…Â²';
            document.getElementById(`${towerType}TotalCost`).innerHTML = formatNumber(data.totalCost) + ' Ø±ÙŠØ§Ù„';
            document.getElementById(`${towerType}ROI`).innerHTML = data.roi.toFixed(2) + '%';

            // Ø­Ø³Ø§Ø¨ ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶ Ø¨Ø³ÙŠØ·
            const landCostPerTower = projectData.sharedCosts.totalLandCost / 4;
            document.getElementById(`${towerType}LandCost`).innerHTML = `<strong style="color: #f39c12;">${formatNumber(landCostPerTower)} Ø±ÙŠØ§Ù„</strong>`;
            
            // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¶ Ù…Ù† Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©
            const landRatio = data.totalCost > 0 ? (landCostPerTower / data.totalCost) * 100 : 0;
            document.getElementById(`${towerType}LandRatio`).innerHTML = `<strong style="color: #f39c12;">${landRatio.toFixed(1)}%</strong>`;

            // ğŸ¯ Ø­Ø³Ø§Ø¨ ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµØ­ÙŠØ­Ø©
            const buildingCost = data.buildingCost || (data.totalArea * (data.buildCost || 0));
            document.getElementById(`${towerType}BuildCostResult`).innerHTML = `<strong style="color: #e74c3c; font-size: 1.1em;">${formatNumber(buildingCost)} Ø±ÙŠØ§Ù„</strong>`; 

            // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±Ø¬
            if (towerType === 'sale1' || towerType === 'sale2') {
                document.getElementById(`${towerType}Units`).innerHTML = (data.units || 0).toString();
                document.getElementById(`${towerType}Revenue`).innerHTML = formatNumber(data.revenue || 0) + ' Ø±ÙŠØ§Ù„';
                const profitElement = document.getElementById(`${towerType}Profit`);
                profitElement.innerHTML = formatNumber(data.profit || 0) + ' Ø±ÙŠØ§Ù„';
                profitElement.className = `result-value ${(data.profit || 0) >= 0 ? 'profit-positive' : 'profit-negative'}`;
                
            } else if (towerType === 'rental') {
                document.getElementById('rentalUnits').innerHTML = (data.units || 0).toString();
                document.getElementById('rentalMonthlyIncome').innerHTML = formatNumber(data.monthlyIncome || 0) + ' Ø±ÙŠØ§Ù„';
                document.getElementById('rentalAnnualIncome').innerHTML = formatNumber(data.annualRent || 0) + ' Ø±ÙŠØ§Ù„';
                document.getElementById('rentalPayback').innerHTML = (data.paybackPeriod === Infinity || !data.paybackPeriod) ? 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' : data.paybackPeriod.toFixed(1) + ' Ø³Ù†Ø©';
                    
            } else if (towerType === 'hotel') {
                document.getElementById('hotelRooms').innerHTML = (data.rooms || 0).toString();
                document.getElementById('hotelOperationalArea').innerHTML = formatNumber(data.operationalArea || 0) + ' Ù…Â²';
                document.getElementById('hotelAvailableRoomArea').innerHTML = formatNumber(data.availableRoomArea || 0) + ' Ù…Â²';
                document.getElementById('hotelGrossRevenue').innerHTML = formatNumber(data.grossRevenue || 0) + ' Ø±ÙŠØ§Ù„';
                document.getElementById('hotelOperatingCostsAmount').innerHTML = formatNumber(data.operatingCosts || 0) + ' Ø±ÙŠØ§Ù„';
                const netElement = document.getElementById('hotelNetIncome');
                netElement.innerHTML = formatNumber(data.netIncome || 0) + ' Ø±ÙŠØ§Ù„';
                netElement.className = `result-value ${(data.netIncome || 0) >= 0 ? 'profit-positive' : 'profit-negative'}`;
                document.getElementById('hotelPayback').innerHTML = (data.paybackPeriod === Infinity || !data.paybackPeriod) ? 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' : data.paybackPeriod.toFixed(1) + ' Ø³Ù†Ø©';
            }
            
            console.log(`âœ… SIMPLE UPDATE COMPLETE FOR ${towerType.toUpperCase()}`);
            
        } catch (error) {
            console.error(`ğŸ’¥ ERROR in simple update ${towerType}:`, error);
        }
    }

    function highlightBestTower() {
        try {
            // Remove existing highlights
            document.querySelectorAll('.tower-result').forEach(el => el.classList.remove('best-tower'));

            if (!projectData) return;

            const { sale1, sale2, rental, hotel } = projectData;
            const rois = [
                { element: 'sale1Results', value: sale1.roi },
                { element: 'sale2Results', value: sale2.roi },
                { element: 'rentalResults', value: rental.roi },
                { element: 'hotelResults', value: hotel.roi }
            ];

            const bestTower = rois.reduce((prev, current) => (prev.value > current.value) ? prev : current);
            const bestElement = document.getElementById(bestTower.element);
            if (bestElement) {
                bestElement.classList.add('best-tower');
            }
        } catch (error) {
            console.error('Error highlighting best tower:', error);
        }
    }

    function exportToCSV() {
        if (!projectData || Object.keys(projectData).length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }

        try {
            const { sale1, sale2, rental, hotel, totals } = projectData;
            
            let csv = 'Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±Ø¬,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²),Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª,Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Ø±ÙŠØ§Ù„),ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶ (Ø±ÙŠØ§Ù„),Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¶ (%),Ø§Ù„Ø¯Ø®Ù„/Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„),Ø§Ù„Ø¹Ø§Ø¦Ø¯ (%),ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ (Ø³Ù†Ø©)\n';
            
            const landCostPerTower = projectData.sharedCosts.totalLandCost / 4;
            const sale1LandRatio = sale1.totalCost > 0 ? (landCostPerTower / sale1.totalCost) * 100 : 0;
            const sale2LandRatio = sale2.totalCost > 0 ? (landCostPerTower / sale2.totalCost) * 100 : 0;
            const rentalLandRatio = rental.totalCost > 0 ? (landCostPerTower / rental.totalCost) * 100 : 0;
            const hotelLandRatio = hotel.totalCost > 0 ? (landCostPerTower / hotel.totalCost) * 100 : 0;
            
            csv += `Ø¨Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ¹ #1,${sale1.totalArea},${sale1.units},${sale1.totalCost},${landCostPerTower},${sale1LandRatio.toFixed(1)},${sale1.profit},${sale1.roi.toFixed(2)},ÙÙˆØ±ÙŠ\n`;
            csv += `Ø¨Ø±Ø¬ Ø§Ù„Ø¨ÙŠØ¹ #2,${sale2.totalArea},${sale2.units},${sale2.totalCost},${landCostPerTower},${sale2LandRatio.toFixed(1)},${sale2.profit},${sale2.roi.toFixed(2)},ÙÙˆØ±ÙŠ\n`;
            csv += `Ø¨Ø±Ø¬ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±,${rental.totalArea},${rental.units},${rental.totalCost},${landCostPerTower},${rentalLandRatio.toFixed(1)},${rental.annualRent},${rental.roi.toFixed(2)},${rental.paybackPeriod === Infinity ? 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' : rental.paybackPeriod.toFixed(1)}\n`;
            csv += `Ø¨Ø±Ø¬ Ø§Ù„ÙÙ†Ø¯Ù‚,${hotel.totalArea},${hotel.rooms},${hotel.totalCost},${landCostPerTower},${hotelLandRatio.toFixed(1)},${hotel.netIncome},${hotel.roi.toFixed(2)},${hotel.paybackPeriod === Infinity ? 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' : hotel.paybackPeriod.toFixed(1)}\n`;
            csv += `\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª,,,,,,,,\n`;
            csv += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±,,,${totals.investment},,,,\n`;
            csv += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ,,,${totals.annualIncome},,,,\n`;
            csv += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ,,,,,${totals.annualReturn.toFixed(2)},,\n`;

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ø¬Ù…Ø¹_Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        } catch (error) {
            console.error('Error exporting CSV:', error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
    }

    function exportToPDF() {
        window.print();
    }

    function generateDetailedReport() {
        if (!projectData || Object.keys(projectData).length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }

        try {
            const reportWindow = window.open('', '_blank');
            const reportHTML = createDetailedReportHTML();
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
        } catch (error) {
            console.error('Error generating report:', error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
        }
    }

    function createDetailedReportHTML() {
        const { sale1, sale2, rental, hotel, totals } = projectData;
        const currentDate = new Date().toLocaleDateString('ar');
        
        // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨ Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ
        const landCostPerTower = projectData.sharedCosts.totalLandCost / 4;
        const sale1LandRatio = sale1.totalCost > 0 ? (landCostPerTower / sale1.totalCost) * 100 : 0;
        const sale2LandRatio = sale2.totalCost > 0 ? (landCostPerTower / sale2.totalCost) * 100 : 0;
        const rentalLandRatio = rental.totalCost > 0 ? (landCostPerTower / rental.totalCost) * 100 : 0;
        const hotelLandRatio = hotel.totalCost > 0 ? (landCostPerTower / hotel.totalCost) * 100 : 0;

        return `
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
            <meta charset="utf-8">
            <title>ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„ - Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                .header { text-align: center; border-bottom: 3px solid #667eea; padding-bottom: 20px; margin-bottom: 30px; }
                .summary { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px; }
                .tower-section { margin: 30px 0; padding: 20px; border-radius: 10px; }
                .sale1 { background: rgba(52, 152, 219, 0.1); border-left: 5px solid #3498db; }
                .sale2 { background: rgba(41, 128, 185, 0.1); border-left: 5px solid #2980b9; }
                .rental { background: rgba(39, 174, 96, 0.1); border-left: 5px solid #27ae60; }
                .hotel { background: rgba(230, 126, 34, 0.1); border-left: 5px solid #e67e22; }
                .profit-positive { color: #27ae60; font-weight: bold; }
                .profit-negative { color: #e74c3c; font-weight: bold; }
                .recommendations { background: #e8f5e8; padding: 20px; border-radius: 10px; margin-top: 30px; }
                @media print { body { margin: 20px; } }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>ğŸ¢ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - 4 Ø£Ø¨Ø±Ø§Ø¬</h1>
                <p>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${currentDate}</p>
                <p>ğŸ“ Ù…Ø¬Ù…Ø¹ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª Ø¹Ù„Ù‰ Ø£Ø±Ø¶ ÙˆØ§Ø­Ø¯Ø©</p>
            </div>
            
            <div class="summary">
                <h2>ğŸ“‹ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ</h2>
                <ul>
                    <li><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> ${formatNumber(totals.investment)} Ø±ÙŠØ§Ù„</li>
                    <li><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> ${formatNumber(totals.annualIncome)} Ø±ÙŠØ§Ù„</li>
                    <li><strong>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ:</strong> ${totals.annualReturn.toFixed(2)}%</li>
                    <li><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬:</strong> 4 Ø£Ø¨Ø±Ø§Ø¬ (2 Ø¨ÙŠØ¹ + 1 Ø¥ÙŠØ¬Ø§Ø± + 1 ÙÙ†Ø¯Ù‚)</li>
                    <li><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø£Ø±Ø¶:</strong> ${formatNumber(safeParseFloat(document.getElementById('totalLandArea').value))} Ù…Â²</li>
                </ul>
            </div>

            <h2>ğŸ—ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬</h2>
            
            <div class="tower-section sale1">
                <h3>ğŸ¢ Ø¨Ø±Ø¬ Ø´Ù‚Ù‚ Ù„Ù„Ø¨ÙŠØ¹ #1</h3>
                <ul>
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${sale1.floors}</li>
                    <li>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${formatNumber(sale1.totalArea)} Ù…Â²</li>
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚: ${sale1.units}</li>
                    <li>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ${formatNumber(sale1.totalCost)} Ø±ÙŠØ§Ù„</li>
                    <li style="color: #f39c12;"><strong>ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶: ${formatNumber(landCostPerTower)} Ø±ÙŠØ§Ù„ (${sale1LandRatio.toFixed(1)}%)</strong></li>
                    <li>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: ${formatNumber(sale1.revenue)} Ø±ÙŠØ§Ù„</li>
                    <li class="${sale1.profit >= 0 ? 'profit-positive' : 'profit-negative'}">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ${formatNumber(sale1.profit)} Ø±ÙŠØ§Ù„</li>
                    <li>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±: ${sale1.roi.toFixed(2)}%</li>
                </ul>
            </div>

            <div class="tower-section sale2">
                <h3>ğŸ˜ï¸ Ø¨Ø±Ø¬ Ø´Ù‚Ù‚ Ù„Ù„Ø¨ÙŠØ¹ #2</h3>
                <ul>
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${sale2.floors}</li>
                    <li>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${formatNumber(sale2.totalArea)} Ù…Â²</li>
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‚Ù‚: ${sale2.units}</li>
                    <li>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ${formatNumber(sale2.totalCost)} Ø±ÙŠØ§Ù„</li>
                    <li style="color: #f39c12;"><strong>ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶: ${formatNumber(landCostPerTower)} Ø±ÙŠØ§Ù„ (${sale2LandRatio.toFixed(1)}%)</strong></li>
                    <li>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: ${formatNumber(sale2.revenue)} Ø±ÙŠØ§Ù„</li>
                    <li class="${sale2.profit >= 0 ? 'profit-positive' : 'profit-negative'}">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ${formatNumber(sale2.profit)} Ø±ÙŠØ§Ù„</li>
                    <li>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±: ${sale2.roi.toFixed(2)}%</li>
                </ul>
            </div>

            <div class="tower-section rental">
                <h3>ğŸ  Ø¨Ø±Ø¬ Ù…ÙƒØ§ØªØ¨ Ù„Ù„Ø¥ÙŠØ¬Ø§Ø±</h3>
                <ul>
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${rental.floors}</li>
                    <li>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${formatNumber(rental.totalArea)} Ù…Â²</li>
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙƒØ§ØªØ¨: ${rental.units}</li>
                    <li>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ${formatNumber(rental.totalCost)} Ø±ÙŠØ§Ù„</li>
                    <li style="color: #f39c12;"><strong>ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶: ${formatNumber(landCostPerTower)} Ø±ÙŠØ§Ù„ (${rentalLandRatio.toFixed(1)}%)</strong></li>
                    <li class="profit-positive">Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ: ${formatNumber(rental.annualRent)} Ø±ÙŠØ§Ù„</li>
                    <li>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ: ${rental.roi.toFixed(2)}%</li>
                    <li>ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯: ${rental.paybackPeriod === Infinity ? 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' : rental.paybackPeriod.toFixed(1) + ' Ø³Ù†Ø©'}</li>
                </ul>
            </div>

            <div class="tower-section hotel">
                <h3>ğŸ¨ Ø¨Ø±Ø¬ ÙÙ†Ø¯Ù‚ Ù„Ù„ØªØ´ØºÙŠÙ„</h3>
                <ul>
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: ${hotel.floors}</li>
                    <li>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${formatNumber(hotel.totalArea)} Ù…Â²</li>
                    <li style="color: #f39c12;"><strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©: ${formatNumber(hotel.operationalArea)} Ù…Â² (${hotel.operationalAreaRatio}%)</strong></li>
                    <li style="color: #27ae60;"><strong>Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ØªØ§Ø­Ø©: ${formatNumber(hotel.availableRoomArea)} Ù…Â²</strong></li>
                    <li>Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù: ${hotel.rooms}</li>
                    <li>Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ${formatNumber(hotel.totalCost)} Ø±ÙŠØ§Ù„</li>
                    <li style="color: #f39c12;"><strong>ØªÙƒÙ„ÙØ© Ø§Ù„Ø£Ø±Ø¶: ${formatNumber(landCostPerTower)} Ø±ÙŠØ§Ù„ (${hotelLandRatio.toFixed(1)}%)</strong></li>
                    <li class="profit-positive">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatNumber(hotel.grossRevenue)} Ø±ÙŠØ§Ù„</li>
                    <li class="profit-negative">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©: ${formatNumber(hotel.operatingCosts)} Ø±ÙŠØ§Ù„</li>
                    <li class="${hotel.netIncome >= 0 ? 'profit-positive' : 'profit-negative'}">ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ: ${formatNumber(hotel.netIncome)} Ø±ÙŠØ§Ù„</li>
                    <li>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ØµØ§ÙÙŠ: ${hotel.roi.toFixed(2)}%</li>
                    <li>ÙØªØ±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯: ${hotel.paybackPeriod === Infinity ? 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' : hotel.paybackPeriod.toFixed(1) + ' Ø³Ù†Ø©'}</li>
                </ul>
            </div>

            <div class="recommendations">
                <h2>ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2>
                <ul>
                    <li><strong>Ø§Ù„ØªÙ†ÙˆÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ:</strong> ÙŠÙˆÙØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ØªÙ†ÙˆÙŠØ¹Ø§Ù‹ Ù…Ù…ØªØ§Ø²Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª Ù‚ØµÙŠØ±Ø© ÙˆØ·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰</li>
                    <li><strong>Ø§Ù„ØªÙƒØ§Ù…Ù„:</strong> Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© ØªØ¹Ø²Ø² Ù…Ù† Ù‚ÙŠÙ…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬</li>
                    <li><strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±:</strong> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø¹Ù„Ù‰ 4 Ø£Ù†ÙˆØ§Ø¹ Ø§Ø³ØªØ«Ù…Ø§Ø± Ù…Ø®ØªÙ„ÙØ©</li>
                    <li><strong>Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:</strong> Ø¨Ø±Ø¬ÙŠ Ø§Ù„Ø¨ÙŠØ¹ ÙŠÙˆÙØ±Ø§Ù† Ø³ÙŠÙˆÙ„Ø© ÙÙˆØ±ÙŠØ© Ù„ØªÙ…ÙˆÙŠÙ„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</li>
                    <li><strong>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªÙ…Ø±:</strong> Ø¨Ø±Ø¬ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± ÙˆØ§Ù„ÙÙ†Ø¯Ù‚ ÙŠØ¶Ù…Ù†Ø§Ù† Ø¯Ø®Ù„Ø§Ù‹ Ù…Ø³ØªÙ…Ø±Ø§Ù‹</li>
                    <li><strong>ØªØ­Ù„ÙŠÙ„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¶:</strong> Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØ£Ø«ÙŠØ± ØªÙ‚Ù„Ø¨Ø§Øª Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ Ø¹Ù„Ù‰ ÙƒÙ„ Ø¨Ø±Ø¬ Ø­Ø³Ø¨ Ù†Ø³Ø¨ØªÙ‡</li>
                    <li><strong>ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙÙ†Ø¯Ù‚:</strong> ØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</li>
                </ul>
            </div>
            
            <footer style="margin-top: 50px; text-align: center; color: #666; border-top: 1px solid #ddd; padding-top: 20px;">
                <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
                <p><small>Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠØ© ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠØ´ÙƒÙ„ Ù†ØµÙŠØ­Ø© Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© Ù…Ù„Ø²Ù…Ø©</small></p>
            </footer>
        </body>
        </html>
        `;
    }

    function saveProject() {
        if (!projectData || Object.keys(projectData).length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }

        try {
            const inputs = {};
            document.querySelectorAll('input').forEach(input => {
                inputs[input.id] = input.value;
            });

            const saveData = {
                inputs: inputs,
                results: projectData,
                timestamp: new Date().toISOString(),
                projectType: 'Ù…Ø¬Ù…Ø¹ Ù…ØªÙƒØ§Ù…Ù„ - 4 Ø£Ø¨Ø±Ø§Ø¬'
            };

            const projectName = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:', `Ù…Ø¬Ù…Ø¹_Ù…ØªÙƒØ§Ù…Ù„_${new Date().toLocaleDateString('ar')}`);
            if (projectName) {
                const blob = new Blob([JSON.stringify(saveData, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${projectName}.json`;
                link.click();
                
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­');
            }
        } catch (error) {
            console.error('Error saving project:', error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹');
        }
    }

    // Input validation
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('input', function() {
            let value = parseFloat(this.value);
            
            if (isNaN(value) || value < 0) {
                this.value = 0;
                return;
            }
            
            // Specific validations
            if (this.id === 'sharedAreaRatio' && value > 50) {
                this.value = 50;
            } else if (this.id === 'hotelOperationalAreaRatio' && value > 50) {
                this.value = 50;
            } else if (this.id.includes('OccupancyRate') && value > 100) {
                this.value = 100;
            } else if (this.id.includes('OperatingCosts') && value > 100) {
                this.value = 100;
            } else if (this.id === 'loanRatio' && value > 100) {
                this.value = 100;
            } else if (this.id === 'interestRate' && value > 50) {
                this.value = 50;
            }
            
            // Ensure minimum values for critical fields
            if ((this.id.includes('Size') || this.id.includes('Floors')) && value < 1) {
                this.value = 1;
            }
        });
    });

    // Auto-calculate with debounce
    let debounceTimer;
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                if (Object.keys(projectData).length > 0) {
                    calculateProject();
                }
            }, 2000);
        });
    });

    // Print styles
    const printStyles = `
        <style media="print">
            body { background: white !important; }
            .container { box-shadow: none !important; background: white !important; }
            .export-buttons, .calculate-btn, .towers-inputs-grid, .inputs-section, .shared-costs-section { display: none !important; }
            h1 { color: black !important; -webkit-text-fill-color: black !important; }
            .tower-result, .summary-card { border: 2px solid #333 !important; }
            .project-overview { page-break-after: always; }
        </style>
    `;
    document.head.insertAdjacentHTML('beforeend', printStyles);

    // Initialize with sample calculation
    window.addEventListener('load', function() {
        // Auto-calculate after a short delay to show functionality
        setTimeout(() => {
            calculateProject();
        }, 1000);
    });

</script>
<script id="defaultProjectData" type="application/json">{
  "inputs": {
    "totalLandArea": "16000",
    "landCostPerMeter": "15000",
    "sharedAreaRatio": "15",
    "sharedAreaCost": "3000",
    "infrastructureCost": "5000000",
    "designAndPlanningCost": "2000000",
    "sale1Floors": "12",
    "sale1FloorArea": "2000",
    "sale1ApartmentSize": "140",
    "sale1BuildCost": "4500",
    "sale1SellPrice": "7500",
    "sale2Floors": "12",
    "sale2FloorArea": "2000",
    "sale2ApartmentSize": "140",
    "sale2BuildCost": "4500",
    "sale2SellPrice": "7500",
    "rentalFloors": "12",
    "rentalFloorArea": "2000",
    "rentalOfficeSize": "300",
    "rentalBuildCost": "5000",
    "rentalPricePerMeter": "1200",
    "rentalOccupancyRate": "80",
    "hotelFloors": "12",
    "hotelFloorArea": "2000",
    "hotelRoomSize": "50",
    "hotelBuildCost": "6500",
    "hotelRoomRate": "650",
    "hotelOccupancyRate": "70",
    "hotelOperatingCosts": "30",
    "hotelOperationalAreaRatio": "25",
    "hotelServiceRatio": "10",
    "loanRatio": "0",
    "loanYears": "0",
    "interestRate": "0"
  }
}</script></body>
</html>