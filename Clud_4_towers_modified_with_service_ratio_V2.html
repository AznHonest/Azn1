<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑŸÖÿ¨ŸÖÿπ ÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑ - 4 ÿ£ÿ®ÿ±ÿßÿ¨ ÿπŸÑŸâ ÿ£ÿ±ÿ∂ Ÿàÿßÿ≠ÿØÿ©</title>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .project-overview {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #667eea;
        }

        .towers-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
            position: relative;
        }

        .tower-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 3px solid;
            transition: all 0.3s ease;
            text-align: center;
        }

        .tower-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .tower-sale-1 { border-color: #3498db; }
        .tower-sale-2 { border-color: #2980b9; }
        .tower-rental { border-color: #27ae60; }
        .tower-hotel { border-color: #e67e22; }

        .tower-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .tower-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .shared-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            z-index: 10;
        }

        .inputs-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .towers-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .tower-inputs {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid;
        }

        .tower-inputs.sale1 { border-color: #3498db; }
        .tower-inputs.sale2 { border-color: #2980b9; }
        .tower-inputs.rental { border-color: #27ae60; }
        .tower-inputs.hotel { border-color: #e67e22; }

        .input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            direction: ltr;
            text-align: center;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .calculate-btn {
            display: block;
            width: 250px;
            margin: 30px auto;
            padding: 18px 35px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-container {
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.2);
        }

        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .summary-card .value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #667eea;
        }

        .towers-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .tower-result {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .tower-result.sale1 { border-color: #3498db; }
        .tower-result.sale2 { border-color: #2980b9; }
        .tower-result.rental { border-color: #27ae60; }
        .tower-result.hotel { border-color: #e67e22; }

        .tower-result h3 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: #2c3e50;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #555;
        }

        .result-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .profit-positive { color: #27ae60; }
        .profit-negative { color: #e74c3c; }

        .total-investment {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
        }

        .total-investment h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .total-investment .amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .best-tower {
            border: 4px solid #f39c12 !important;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3) !important;
            position: relative;
        }

        .best-tower::before {
            content: "üèÜ ÿßŸÑÿ£ŸÅÿ∂ŸÑ";
            position: absolute;
            top: -10px;
            right: 15px;
            background: #f39c12;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .shared-costs-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #667eea;
        }

        .export-buttons {
            margin-top: 20px;
            text-align: center;
            gap: 10px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 12px 25px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .export-btn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
            text-align: center;
        }

        @media (max-width: 1200px) {
            .towers-inputs-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .towers-layout {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(4, 1fr);
            }

            .shared-area {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                margin: 20px auto;
            }

            .towers-inputs-grid {
                grid-template-columns: 1fr;
            }

            .inputs-grid {
                grid-template-columns: 1fr;
            }

            .towers-results {
                grid-template-columns: 1fr;
            }
        }
</style>
</head>
<body>
<div class="container">
<h1>üè¢ ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑŸÖÿ¨ŸÖÿπ ÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑ - 4 ÿ£ÿ®ÿ±ÿßÿ¨ ÿπŸÑŸâ ÿ£ÿ±ÿ∂ Ÿàÿßÿ≠ÿØÿ©</h1>
<div class="project-overview">
<h2 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">üìã ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</h2>
<div class="towers-layout">
<div class="tower-card tower-sale-1">
<div class="tower-icon">üè¢</div>
<div class="tower-title">ÿ®ÿ±ÿ¨ ÿ¥ŸÇŸÇ ŸÑŸÑÿ®Ÿäÿπ #1</div>
<p>ÿ¥ŸÇŸÇ ÿ≥ŸÉŸÜŸäÿ© ŸÖÿ™ŸÜŸàÿπÿ© ÿßŸÑŸÖÿ≥ÿßÿ≠ÿßÿ™</p>
</div>
<div class="tower-card tower-sale-2">
<div class="tower-icon">üèòÔ∏è</div>
<div class="tower-title">ÿ®ÿ±ÿ¨ ÿ¥ŸÇŸÇ ŸÑŸÑÿ®Ÿäÿπ #2</div>
<p>ÿ¥ŸÇŸÇ ÿ≥ŸÉŸÜŸäÿ© ŸÅÿßÿÆÿ±ÿ©</p>
</div>
<div class="tower-card tower-rental">
<div class="tower-icon">üè†</div>
<div class="tower-title">ÿ®ÿ±ÿ¨ ŸÖŸÉÿßÿ™ÿ® ŸÑŸÑÿ•Ÿäÿ¨ÿßÿ±</div>
<p>ŸÖŸÉÿßÿ™ÿ® ÿ™ÿ¨ÿßÿ±Ÿäÿ© Ÿàÿ•ÿØÿßÿ±Ÿäÿ©</p>
</div>
<div class="tower-card tower-hotel">
<div class="tower-icon">üè®</div>
<div class="tower-title">ÿ®ÿ±ÿ¨ ŸÅŸÜÿØŸÇ ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ</div>
<p>ŸÅŸÜÿØŸÇ ŸàÿÆÿØŸÖÿßÿ™ ÿ∂ŸäÿßŸÅÿ©</p>
</div>
<div class="shared-area">
                üå≥ ŸÖŸÜÿ∑ŸÇÿ© ŸÖÿ¥ÿ™ÿ±ŸÉÿ©<br/>
                ŸàŸÖÿ±ÿßŸÅŸÇ ÿπÿßŸÖÿ©
            </div>
</div>
</div>
<div class="shared-costs-section">
<h3 class="section-title">üèûÔ∏è ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ±ÿ∂ ŸàÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ©</h3>
<div class="inputs-grid">
<div class="input-group">
<label for="totalLandArea">ÿ•ÿ¨ŸÖÿßŸÑŸä ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ£ÿ±ÿ∂ (ŸÖ¬≤)</label>
<input id="totalLandArea" min="0" step="100" type="number" value="18600"/>
</div>
<div class="input-group">
<label for="landCostPerMeter">ÿ≥ÿπÿ± ŸÖÿ™ÿ± ÿßŸÑÿ£ÿ±ÿ∂ (ÿ±ŸäÿßŸÑ)</label>
<input id="landCostPerMeter" min="0" step="100" type="number" value="12000"/>
</div>
<div class="input-group">
<label for="sharedAreaRatio">ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ© (%)</label>
<input id="sharedAreaRatio" max="50" min="0" step="1" type="number" value="15"/>
</div>
<div class="input-group">
<label for="sharedAreaCost">ÿ™ŸÉŸÑŸÅÿ© ÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ© (ÿ±ŸäÿßŸÑ/ŸÖ¬≤)</label>
<input id="sharedAreaCost" min="0" step="100" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="infrastructureCost">ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ®ŸÜŸäÿ© ÿßŸÑÿ™ÿ≠ÿ™Ÿäÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ© (ÿ±ŸäÿßŸÑ)</label>
<input id="infrastructureCost" min="0" step="100000" type="number" value="5000000"/>
</div>
<div class="input-group">
<label for="designAndPlanningCost">ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ™ÿµŸÖŸäŸÖ ŸàÿßŸÑÿ™ÿÆÿ∑Ÿäÿ∑ (ÿ±ŸäÿßŸÑ)</label>
<input id="designAndPlanningCost" min="0" step="50000" type="number" value="2000000"/>
</div>
</div>
</div>
<div class="towers-inputs-grid">
<div class="tower-inputs sale1">
<h3 class="section-title">üè¢ ÿ®ÿ±ÿ¨ ÿ¥ŸÇŸÇ ŸÑŸÑÿ®Ÿäÿπ #1</h3>
<div class="input-group">
<label for="sale1Floors">ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ±</label>
<input id="sale1Floors" min="1" step="1" type="number" value="10"/>
</div>
<div class="input-group">
<label for="sale1FloorArea">ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿØŸàÿ± ÿßŸÑŸàÿßÿ≠ÿØ (ŸÖ¬≤)</label>
<input id="sale1FloorArea" min="0" step="50" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="sale1ApartmentSize">ŸÖÿ™Ÿàÿ≥ÿ∑ ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ¥ŸÇÿ© (ŸÖ¬≤)</label>
<input id="sale1ApartmentSize" min="1" step="10" type="number" value="140"/>
</div>
<div class="input-group">
<label for="sale1BuildCost">ÿ™ŸÉŸÑŸÅÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸÖÿ™ÿ± (ÿ±ŸäÿßŸÑ)</label>
<input id="sale1BuildCost" min="0" step="50" type="number" value="4500"/>
</div>
<div class="input-group">
<label for="sale1SellPrice">ÿ≥ÿπÿ± ÿ®Ÿäÿπ ÿßŸÑŸÖÿ™ÿ± (ÿ±ŸäÿßŸÑ)</label>
<input id="sale1SellPrice" min="0" step="100" type="number" value="8500"/>
</div>
</div>
<div class="tower-inputs sale2">
<h3 class="section-title">üèòÔ∏è ÿ®ÿ±ÿ¨ ÿ¥ŸÇŸÇ ŸÑŸÑÿ®Ÿäÿπ #2</h3>
<div class="input-group">
<label for="sale2Floors">ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ±</label>
<input id="sale2Floors" min="1" step="1" type="number" value="10"/>
</div>
<div class="input-group">
<label for="sale2FloorArea">ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿØŸàÿ± ÿßŸÑŸàÿßÿ≠ÿØ (ŸÖ¬≤)</label>
<input id="sale2FloorArea" min="0" step="50" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="sale2ApartmentSize">ŸÖÿ™Ÿàÿ≥ÿ∑ ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ¥ŸÇÿ© (ŸÖ¬≤)</label>
<input id="sale2ApartmentSize" min="1" step="10" type="number" value="140"/>
</div>
<div class="input-group">
<label for="sale2BuildCost">ÿ™ŸÉŸÑŸÅÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸÖÿ™ÿ± (ÿ±ŸäÿßŸÑ)</label>
<input id="sale2BuildCost" min="0" step="50" type="number" value="4500"/>
</div>
<div class="input-group">
<label for="sale2SellPrice">ÿ≥ÿπÿ± ÿ®Ÿäÿπ ÿßŸÑŸÖÿ™ÿ± (ÿ±ŸäÿßŸÑ)</label>
<input id="sale2SellPrice" min="0" step="100" type="number" value="8500"/>
</div>
</div>
<div class="tower-inputs rental">
<h3 class="section-title">üè† ÿ®ÿ±ÿ¨ ŸÖŸÉÿßÿ™ÿ® ŸÑŸÑÿ•Ÿäÿ¨ÿßÿ±</h3>
<div class="input-group">
<label for="rentalFloors">ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ±</label>
<input id="rentalFloors" min="1" step="1" type="number" value="10"/>
</div>
<div class="input-group">
<label for="rentalFloorArea">ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿØŸàÿ± ÿßŸÑŸàÿßÿ≠ÿØ (ŸÖ¬≤)</label>
<input id="rentalFloorArea" min="0" step="50" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="rentalOfficeSize">ŸÖÿ™Ÿàÿ≥ÿ∑ ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖŸÉÿ™ÿ® (ŸÖ¬≤)</label>
<input id="rentalOfficeSize" min="1" step="10" type="number" value="300"/>
</div>
<div class="input-group">
<label for="rentalBuildCost">ÿ™ŸÉŸÑŸÅÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸÖÿ™ÿ± (ÿ±ŸäÿßŸÑ)</label>
<input id="rentalBuildCost" min="0" step="50" type="number" value="5000"/>
</div>
<div class="input-group">
<label for="rentalPricePerMeter">ÿ•Ÿäÿ¨ÿßÿ± ÿßŸÑŸÖÿ™ÿ± ÿ≥ŸÜŸàŸäÿßŸã (ÿ±ŸäÿßŸÑ)</label>
<input id="rentalPricePerMeter" min="0" step="10" type="number" value="1200"/>
</div>
<div class="input-group">
<label for="rentalOccupancyRate">ŸÖÿπÿØŸÑ ÿßŸÑÿ•ÿ¥ÿ∫ÿßŸÑ (%)</label>
<input id="rentalOccupancyRate" max="100" min="0" step="1" type="number" value="80"/>
</div>
</div>
<div class="tower-inputs hotel">
<h3 class="section-title">üè® ÿ®ÿ±ÿ¨ ŸÅŸÜÿØŸÇ ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ</h3>
<div class="input-group">
<label for="hotelFloors">ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ±</label>
<input id="hotelFloors" min="1" step="1" type="number" value="10"/>
</div>
<div class="input-group">
<label for="hotelFloorArea">ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿØŸàÿ± ÿßŸÑŸàÿßÿ≠ÿØ (ŸÖ¬≤)</label>
<input id="hotelFloorArea" min="0" step="50" type="number" value="3000"/>
</div>
<div class="input-group">
<label for="hotelRoomSize">ŸÖÿ™Ÿàÿ≥ÿ∑ ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ∫ÿ±ŸÅÿ© (ŸÖ¬≤)</label>
<input id="hotelRoomSize" min="1" step="5" type="number" value="70"/>
</div>
<div class="input-group">
<label for="hotelBuildCost">ÿ™ŸÉŸÑŸÅÿ© ÿ®ŸÜÿßÿ° ÿßŸÑŸÖÿ™ÿ± (ÿ±ŸäÿßŸÑ)</label>
<input id="hotelBuildCost" min="0" step="50" type="number" value="6500"/>
</div>
<div class="input-group">
<label for="hotelRoomRate">ÿ≥ÿπÿ± ÿßŸÑÿ∫ÿ±ŸÅÿ©/ŸÑŸäŸÑÿ© (ÿ±ŸäÿßŸÑ)</label>
<input id="hotelRoomRate" min="0" step="10" type="number" value="650"/>
</div>
<div class="input-group">
<label for="hotelOccupancyRate">ŸÖÿπÿØŸÑ ÿ•ÿ¥ÿ∫ÿßŸÑ ÿßŸÑŸÅŸÜÿØŸÇ (%)</label>
<input id="hotelOccupancyRate" max="100" min="0" step="1" type="number" value="70"/>
</div>
<div class="input-group">
<label for="hotelOperatingCosts">ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑŸäÿ© (%)</label>
<input id="hotelOperatingCosts" max="100" min="0" step="1" type="number" value="30"/>
</div>

<div class="input-group">
<label for="hotelOperationalAreaRatio">ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑŸäÿ© (%)</label>
<input id="hotelOperationalAreaRatio" max="50" min="0" step="1" type="number" value="25"/>
</div>
<div class="input-group">
<label for="hotelServiceRatio">ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿÆÿØŸÖÿßÿ™ ŸÖŸÜ ÿßŸÑÿ•Ÿäÿ±ÿßÿØ (%)</label>
<input id="hotelServiceRatio" max="100" min="0" step="1" type="number" value="5"/>
</div>
</div>
</div>
<div class="inputs-section">
<h3 class="section-title">üí≥ ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÖŸàŸäŸÑ</h3>
<div class="inputs-grid">
<div class="input-group">
<label for="loanRatio">ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ™ŸÖŸàŸäŸÑ ŸÖŸÜ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ŸÉŸÑŸÅÿ© (%)</label>
<input id="loanRatio" max="100" min="0" step="1" type="number" value="0"/>
</div>
<div class="input-group">
<label for="loanYears">ŸÖÿØÿ© ÿßŸÑÿ™ŸÖŸàŸäŸÑ (ÿ≥ŸÜÿ©)</label>
<input id="loanYears" min="1" step="1" type="number" value="0"/>
</div>
<div class="input-group">
<label for="interestRate">ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÅÿßÿ¶ÿØÿ© ÿßŸÑÿ≥ŸÜŸàŸäÿ© (%)</label>
<input id="interestRate" min="0" step="0.1" type="number" value="0"/>
</div>
</div>
</div>
<button class="calculate-btn" onclick="calculateProject()">üîÑ ÿßÿ≠ÿ≥ÿ® ÿßŸÑÿπÿßÿ¶ÿØ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ŸÑŸÑŸÖÿ¨ŸÖÿπ</button>
<div class="loading" id="loading">
<div class="spinner"></div>
<p>ÿ¨ÿßÿ±Ÿä ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿπŸàÿßÿ¶ÿØ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ®ÿ±ÿßÿ¨ ÿßŸÑÿ£ÿ±ÿ®ÿπÿ©...</p>
</div>
<div class="error-message" id="errorMessage" style="display: none;"></div>
<div id="resultsSection" style="display: none;">
<div class="total-investment" id="totalInvestment">
<h2>üí∞ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ± ÿßŸÑŸÖÿ∑ŸÑŸàÿ®</h2>
<div class="amount" id="totalInvestmentAmount">0 ÿ±ŸäÿßŸÑ</div>
<p>ÿ¥ÿßŸÖŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ ŸàÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ©</p>
</div>
<div class="summary-cards" id="summaryCards">
<div class="summary-card">
<h3>üìä ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿπÿßÿ¶ÿØ ÿßŸÑÿ≥ŸÜŸàŸä</h3>
<div class="value" id="totalAnnualReturn">0%</div>
</div>
<div class="summary-card">
<h3>üíµ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿØÿÆŸÑ ÿßŸÑÿ≥ŸÜŸàŸä</h3>
<div class="value" id="totalAnnualIncome">0 ÿ±ŸäÿßŸÑ</div>
</div>
<div class="summary-card">
<h3>üèÜ ÿ£ŸÅÿ∂ŸÑ ÿ®ÿ±ÿ¨ (ÿπÿßÿ¶ÿØ)</h3>
<div class="value" id="bestTowerROI">-</div>
</div>
<div class="summary-card">
<h3>üíé ÿ£ÿπŸÑŸâ ÿØÿÆŸÑ (ÿ®ÿ±ÿ¨)</h3>
<div class="value" id="highestIncomeTower">-</div>
</div>
<div class="summary-card">
<h3>‚è±Ô∏è ŸÅÿ™ÿ±ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿØÿßÿØ</h3>
<div class="value" id="paybackPeriod">0 ÿ≥ŸÜÿ©</div>
</div>
</div>
<div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
<h4 style="color: #1976d2; margin-bottom: 10px;">üí° ŸÖŸÑÿßÿ≠ÿ∏ÿ© ŸÖŸáŸÖÿ© ÿ≠ŸàŸÑ ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ</h4>
<p style="color: #424242; font-size: 0.9rem;">
                üìä <strong>ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©</strong> ÿ™ÿ¥ŸÖŸÑ: 
                üèûÔ∏è <strong>ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂</strong> + 
                üèóÔ∏è <strong>ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ®ŸÜÿßÿ°</strong> + 
                üå≥ <strong>ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ©</strong> + 
                üöß <strong>ÿßŸÑÿ®ŸÜŸäÿ© ÿßŸÑÿ™ÿ≠ÿ™Ÿäÿ©</strong>
</p>
</div>
<div class="towers-results" id="towersResults">
<div class="tower-result sale1" id="sale1Results">
<h3>üè¢ ÿ®ÿ±ÿ¨ ÿ¥ŸÇŸÇ ŸÑŸÑÿ®Ÿäÿπ #1</h3>
<div class="result-item">
<span class="result-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©:</span>
<span class="result-value" id="sale1TotalArea">0 ŸÖ¬≤</span>
</div>
<div class="result-item">
<span class="result-label">ÿπÿØÿØ ÿßŸÑÿ¥ŸÇŸÇ:</span>
<span class="result-value" id="sale1Units">0</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">üèûÔ∏è ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂ (ÿ≠ÿµÿ© ÿßŸÑÿ®ÿ±ÿ¨):</span>
<span class="result-value" id="sale1LandCost">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">üìä ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ∂ ŸÖŸÜ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©:</span>
<span class="result-value" id="sale1LandRatio">0%</span>
</div>
<div class="result-item">
<span class="result-label">üèóÔ∏è ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ®ŸÜÿßÿ° ŸÅŸÇÿ∑:</span>
<span class="result-value" id="sale1BuildCostResult">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item" style="background: rgba(108, 117, 125, 0.1); font-weight: bold;">
<span class="result-label">üìä ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©:</span>
<span class="result-value" id="sale1TotalCost">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™:</span>
<span class="result-value profit-positive" id="sale1Revenue">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿµÿßŸÅŸä ÿßŸÑÿ±ÿ®ÿ≠:</span>
<span class="result-value" id="sale1Profit">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿßŸÑÿπÿßÿ¶ÿØ ÿπŸÑŸâ ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ±:</span>
<span class="result-value" id="sale1ROI">0%</span>
</div>
</div>
<div class="tower-result sale2" id="sale2Results">
<h3>üèòÔ∏è ÿ®ÿ±ÿ¨ ÿ¥ŸÇŸÇ ŸÑŸÑÿ®Ÿäÿπ #2</h3>
<div class="result-item">
<span class="result-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©:</span>
<span class="result-value" id="sale2TotalArea">0 ŸÖ¬≤</span>
</div>
<div class="result-item">
<span class="result-label">ÿπÿØÿØ ÿßŸÑÿ¥ŸÇŸÇ:</span>
<span class="result-value" id="sale2Units">0</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">üèûÔ∏è ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂ (ÿ≠ÿµÿ© ÿßŸÑÿ®ÿ±ÿ¨):</span>
<span class="result-value" id="sale2LandCost">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">üìä ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ∂ ŸÖŸÜ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©:</span>
<span class="result-value" id="sale2LandRatio">0%</span>
</div>
<div class="result-item">
<span class="result-label">üèóÔ∏è ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ®ŸÜÿßÿ° ŸÅŸÇÿ∑:</span>
<span class="result-value" id="sale2BuildCostResult">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item" style="background: rgba(108, 117, 125, 0.1); font-weight: bold;">
<span class="result-label">üìä ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©:</span>
<span class="result-value" id="sale2TotalCost">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™:</span>
<span class="result-value profit-positive" id="sale2Revenue">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿµÿßŸÅŸä ÿßŸÑÿ±ÿ®ÿ≠:</span>
<span class="result-value" id="sale2Profit">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿßŸÑÿπÿßÿ¶ÿØ ÿπŸÑŸâ ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ±:</span>
<span class="result-value" id="sale2ROI">0%</span>
</div>
</div>
<div class="tower-result rental" id="rentalResults">
<h3>üè† ÿ®ÿ±ÿ¨ ŸÖŸÉÿßÿ™ÿ® ŸÑŸÑÿ•Ÿäÿ¨ÿßÿ±</h3>
<div class="result-item">
<span class="result-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©:</span>
<span class="result-value" id="rentalTotalArea">0 ŸÖ¬≤</span>
</div>
<div class="result-item">
<span class="result-label">ÿπÿØÿØ ÿßŸÑŸÖŸÉÿßÿ™ÿ®:</span>
<span class="result-value" id="rentalUnits">0</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">üèûÔ∏è ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂ (ÿ≠ÿµÿ© ÿßŸÑÿ®ÿ±ÿ¨):</span>
<span class="result-value" id="rentalLandCost">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">üìä ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ∂ ŸÖŸÜ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©:</span>
<span class="result-value" id="rentalLandRatio">0%</span>
</div>
<div class="result-item">
<span class="result-label">üèóÔ∏è ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ®ŸÜÿßÿ° ŸÅŸÇÿ∑:</span>
<span class="result-value" id="rentalBuildCostResult">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item" style="background: rgba(108, 117, 125, 0.1); font-weight: bold;">
<span class="result-label">üìä ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©:</span>
<span class="result-value" id="rentalTotalCost">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿßŸÑÿØÿÆŸÑ ÿßŸÑÿ¥Ÿáÿ±Ÿä:</span>
<span class="result-value profit-positive" id="rentalMonthlyIncome">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿßŸÑÿØÿÆŸÑ ÿßŸÑÿ≥ŸÜŸàŸä:</span>
<span class="result-value profit-positive" id="rentalAnnualIncome">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿßŸÑÿπÿßÿ¶ÿØ ÿßŸÑÿ≥ŸÜŸàŸä:</span>
<span class="result-value" id="rentalROI">0%</span>
</div>
<div class="result-item">
<span class="result-label">ŸÅÿ™ÿ±ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿØÿßÿØ:</span>
<span class="result-value" id="rentalPayback">0 ÿ≥ŸÜÿ©</span>
</div>
</div>
<div class="tower-result hotel" id="hotelResults">
<h3>üè® ÿ®ÿ±ÿ¨ ŸÅŸÜÿØŸÇ ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ</h3>
<div class="result-item">
<span class="result-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©:</span>
<span class="result-value" id="hotelTotalArea">0 ŸÖ¬≤</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">üîß ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑŸäÿ©:</span>
<span class="result-value" id="hotelOperationalArea">0 ŸÖ¬≤</span>
</div>
<div class="result-item" style="background: rgba(39, 174, 96, 0.1);">
<span class="result-label">üõèÔ∏è ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ∫ÿ±ŸÅ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©:</span>
<span class="result-value" id="hotelAvailableRoomArea">0 ŸÖ¬≤</span>
</div>
<div class="result-item">
<span class="result-label">ÿπÿØÿØ ÿßŸÑÿ∫ÿ±ŸÅ:</span>
<span class="result-value" id="hotelRooms">0</span>
</div>
<div class="result-item" style="background: rgba(255, 193, 7, 0.1);">
<span class="result-label">üèûÔ∏è ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂ (ÿ≠ÿµÿ© ÿßŸÑÿ®ÿ±ÿ¨):</span>
<span class="result-value" id="hotelLandCost">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">üìä ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ∂ ŸÖŸÜ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©:</span>
<span class="result-value" id="hotelLandRatio">0%</span>
</div>
<div class="result-item">
<span class="result-label">üèóÔ∏è ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ®ŸÜÿßÿ° ŸÅŸÇÿ∑:</span>
<span class="result-value" id="hotelBuildCostResult">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item" style="background: rgba(108, 117, 125, 0.1); font-weight: bold;">
<span class="result-label">üìä ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©:</span>
<span class="result-value" id="hotelTotalCost">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿßŸÑÿ•Ÿäÿ±ÿßÿØ ÿßŸÑÿ≥ŸÜŸàŸä ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:</span>
<span class="result-value profit-positive" id="hotelGrossRevenue">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑŸäÿ©:</span>
<span class="result-value profit-negative" id="hotelOperatingCostsAmount">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿµÿßŸÅŸä ÿßŸÑÿØÿÆŸÑ ÿßŸÑÿ≥ŸÜŸàŸä:</span>
<span class="result-value" id="hotelNetIncome">0 ÿ±ŸäÿßŸÑ</span>
</div>
<div class="result-item">
<span class="result-label">ÿßŸÑÿπÿßÿ¶ÿØ ÿßŸÑÿµÿßŸÅŸä:</span>
<span class="result-value" id="hotelROI">0%</span>
</div>
<div class="result-item">
<span class="result-label">ŸÅÿ™ÿ±ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿØÿßÿØ:</span>
<span class="result-value" id="hotelPayback">0 ÿ≥ŸÜÿ©</span>
</div>
</div>
</div>
<div class="export-buttons">
<button class="export-btn" onclick="exportToCSV()">üìÅ ÿ™ÿµÿØŸäÿ± ÿ•ŸÑŸâ CSV</button>
<button class="export-btn" onclick="exportToPDF()">üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ© ÿ™ŸÇÿ±Ÿäÿ± PDF</button>
<button class="export-btn" onclick="generateDetailedReport()">üìä ÿ™ŸÇÿ±Ÿäÿ± ŸÖŸÅÿµŸÑ</button>
<button class="export-btn" onclick="saveProject()">üíæ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</button>
</div>
</div>
</div>
<script>
    let projectData = {};

    function formatNumber(num) {
        if (isNaN(num) || !isFinite(num)) return '0';
        return new Intl.NumberFormat('en-US').format(Math.round(num));
    }

    function safeParseFloat(value, defaultValue = 0) {
        const parsed = parseFloat(value);
        return isNaN(parsed) ? defaultValue : parsed;
    }

    function safeParseInt(value, defaultValue = 0) {
        const parsed = parseInt(value);
        return isNaN(parsed) ? defaultValue : parsed;
    }

    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => {
            errorDiv.style.display = 'none';
        }, 5000);
    }

    function validateInputs() {
        // Basic validation
        const totalLandArea = safeParseFloat(document.getElementById('totalLandArea').value);
        const landCostPerMeter = safeParseFloat(document.getElementById('landCostPerMeter').value);
        
        if (totalLandArea <= 0) {
            throw new Error('ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ£ÿ±ÿ∂ Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿßŸÑÿµŸÅÿ±');
        }
        
        if (landCostPerMeter <= 0) {
            throw new Error('ÿ≥ÿπÿ± ŸÖÿ™ÿ± ÿßŸÑÿ£ÿ±ÿ∂ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿßŸÑÿµŸÅÿ±');
        }

        // Validate each tower
        const towers = ['sale1', 'sale2', 'rental', 'hotel'];
        for (let tower of towers) {
            const floors = safeParseInt(document.getElementById(`${tower}Floors`).value);
            const floorArea = safeParseFloat(document.getElementById(`${tower}FloorArea`).value);
            
            if (floors <= 0) {
                throw new Error(`ÿπÿØÿØ ÿ£ÿØŸàÿßÿ± ${tower} Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿßŸÑÿµŸÅÿ±`);
            }
            
            if (floorArea <= 0) {
                throw new Error(`ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿØŸàÿ± ${tower} Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿßŸÑÿµŸÅÿ±`);
            }
        }
        
        return true;
    }

    function calculateSharedCosts() {
        try {
            const totalLandArea = safeParseFloat(document.getElementById('totalLandArea').value);
            const landCostPerMeter = safeParseFloat(document.getElementById('landCostPerMeter').value);
            const sharedAreaRatio = safeParseFloat(document.getElementById('sharedAreaRatio').value) / 100;
            const sharedAreaCost = safeParseFloat(document.getElementById('sharedAreaCost').value);
            const infrastructureCost = safeParseFloat(document.getElementById('infrastructureCost').value);
            const designAndPlanningCost = safeParseFloat(document.getElementById('designAndPlanningCost').value);

            const totalLandCost = totalLandArea * landCostPerMeter;
            const sharedArea = totalLandArea * sharedAreaRatio;
            const buildableArea = totalLandArea - sharedArea;
            const sharedAreaDevelopmentCost = sharedArea * sharedAreaCost;
            
            const totalSharedCosts = totalLandCost + sharedAreaDevelopmentCost + infrastructureCost + designAndPlanningCost;
            
            console.log('Shared costs breakdown:', {
                totalLandArea,
                landCostPerMeter,
                totalLandCost,
                sharedAreaDevelopmentCost,
                infrastructureCost,
                designAndPlanningCost,
                totalSharedCosts,
                sharedCostPerTower: totalSharedCosts / 4
            });
            
            return {
                totalLandCost,
                sharedArea,
                buildableArea,
                sharedAreaDevelopmentCost,
                infrastructureCost,
                designAndPlanningCost,
                totalSharedCosts
            };
        } catch (error) {
            console.error('Error in calculateSharedCosts:', error);
            throw new Error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ©');
        }
    }

    async function calculateProject() {
        try {
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';

            await new Promise(resolve => setTimeout(resolve, 500));

            // Validate inputs
            validateInputs();

            // Calculate shared costs
            const sharedCosts = calculateSharedCosts();
            const sharedCostPerTower = sharedCosts.totalSharedCosts / 4;

            // Sale Tower 1 Calculations
            const sale1 = calculateSaleTower('sale1', sharedCostPerTower);
            
            // Sale Tower 2 Calculations
            const sale2 = calculateSaleTower('sale2', sharedCostPerTower);

            // Rental Tower Calculations
            const rental = calculateRentalTower(sharedCostPerTower);

            // Hotel Tower Calculations
            const hotel = calculateHotelTower(sharedCostPerTower);

            // Calculate totals
            const totalInvestment = sale1.totalCost + sale2.totalCost + rental.totalCost + hotel.totalCost;
            
            // For annual income calculation: sale towers give one-time profit, rental and hotel give annual income
            const saleProfit = (sale1.profit || 0) + (sale2.profit || 0);
            const annualIncome = rental.annualRent + hotel.netIncome;
            const totalAnnualIncome = annualIncome; // Only recurring income
            
            const totalAnnualReturn = totalInvestment > 0 ? (totalAnnualIncome / totalInvestment) * 100 : 0;

            // Store data
            projectData = {
                sale1, sale2, rental, hotel,
                sharedCosts,
                totals: {
                    investment: totalInvestment,
                    annualIncome: totalAnnualIncome,
                    annualReturn: totalAnnualReturn,
                    saleProfit: saleProfit
                }
            };

            // Hide loading and show results
            document.getElementById('loading').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'block';
            
            // Update display
            updateResults();

        } catch (error) {
            console.error('Error calculating project:', error);
            document.getElementById('loading').style.display = 'none';
            showError(error.message || 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿØÿÆŸÑÿ©.');
        }
    }

    function calculateSaleTower(towerType, sharedCostPerTower) {
        try {
            console.log(`üî• CALCULATING ${towerType.toUpperCase()} üî•`);
            
            const floors = safeParseInt(document.getElementById(`${towerType}Floors`).value);
            const floorArea = safeParseFloat(document.getElementById(`${towerType}FloorArea`).value);
            const apartmentSize = safeParseFloat(document.getElementById(`${towerType}ApartmentSize`).value, 1);
            const buildCost = safeParseFloat(document.getElementById(`${towerType}BuildCost`).value);
            const sellPrice = safeParseFloat(document.getElementById(`${towerType}SellPrice`).value);

            console.log(`${towerType} inputs:`, { floors, floorArea, apartmentSize, buildCost, sellPrice });

            const totalArea = floorArea * floors;
            const units = Math.floor(totalArea / apartmentSize);
            const buildingCost = totalArea * buildCost;
            const totalCost = buildingCost + sharedCostPerTower;
            const revenue = totalArea * sellPrice;
            const profit = revenue - totalCost;
            const roi = totalCost > 0 ? (profit / totalCost) * 100 : 0;

            const result = {
                floors,
                floorArea,
                apartmentSize,
                buildCost,
                sellPrice,
                totalArea,
                units,
                buildingCost,
                totalCost,
                revenue,
                profit,
                roi
            };

            console.log(`üéØ ${towerType} FINAL RESULT:`, result);
            console.log(`üèóÔ∏è Building Cost Check: ${buildingCost} = ${totalArea} √ó ${buildCost}`);

            return result;
        } catch (error) {
            console.error(`üí• ERROR calculating ${towerType}:`, error);
            throw new Error(`ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ≥ÿßÿ® ${towerType}: ${error.message}`);
        }
    }

    function calculateRentalTower(sharedCostPerTower) {
        try {
            const floors = safeParseInt(document.getElementById('rentalFloors').value);
            const floorArea = safeParseFloat(document.getElementById('rentalFloorArea').value);
            const officeSize = safeParseFloat(document.getElementById('rentalOfficeSize').value, 1);
            const buildCost = safeParseFloat(document.getElementById('rentalBuildCost').value);
            const rentPerMeter = safeParseFloat(document.getElementById('rentalPricePerMeter').value);
            const occupancyRate = safeParseFloat(document.getElementById('rentalOccupancyRate').value) / 100;

            const totalArea = floorArea * floors;
            const units = Math.floor(totalArea / officeSize);
            const buildingCost = totalArea * buildCost;
            const totalCost = buildingCost + sharedCostPerTower;
            const annualRent = totalArea * rentPerMeter * Math.min(occupancyRate, 1);
            const monthlyIncome = annualRent / 12;
            const roi = totalCost > 0 ? (annualRent / totalCost) * 100 : 0;
            const paybackPeriod = annualRent > 0 ? totalCost / annualRent : Infinity;

            console.log('Rental tower detailed calculation:', {
                floors,
                floorArea,
                totalArea,
                buildCost,
                buildingCost,
                sharedCostPerTower,
                totalCost,
                annualRent,
                roi: roi.toFixed(2) + '%'
            });

            return {
                floors,
                floorArea,
                officeSize,
                buildCost,
                rentPerMeter,
                occupancyRate: occupancyRate * 100,
                totalArea,
                units,
                buildingCost,
                totalCost,
                annualRent,
                monthlyIncome,
                roi,
                paybackPeriod
            };
        } catch (error) {
            console.error('Error calculating rental tower:', error);
            throw new Error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ≥ÿßÿ® ÿ®ÿ±ÿ¨ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ±');
        }
    }

    function calculateHotelTower(sharedCostPerTower) {
        try {
            const floors = safeParseInt(document.getElementById('hotelFloors').value);
            const floorArea = safeParseFloat(document.getElementById('hotelFloorArea').value);
            const roomSize = safeParseFloat(document.getElementById('hotelRoomSize').value, 1);
            const buildCost = safeParseFloat(document.getElementById('hotelBuildCost').value);
            const roomRate = safeParseFloat(document.getElementById('hotelRoomRate').value);
            const occupancyRate = safeParseFloat(document.getElementById('hotelOccupancyRate').value) / 100;
            const operatingCostRatio = safeParseFloat(document.getElementById('hotelOperatingCosts').value) / 100;
            const operationalAreaRatio = safeParseFloat(document.getElementById('hotelOperationalAreaRatio').value) / 100;

            const totalArea = floorArea * floors;
            
            // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÅÿπŸÑŸäÿ© ŸÑŸÑÿ∫ÿ±ŸÅ ÿ®ÿπÿØ ÿßÿ≥ÿ™ÿ®ÿπÿßÿØ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑŸäÿ©
            const operationalArea = totalArea * operationalAreaRatio;
            const availableRoomArea = totalArea - operationalArea;
            const rooms = Math.floor(availableRoomArea / roomSize);
            
            const buildingCost = totalArea * buildCost;
            const totalCost = buildingCost + sharedCostPerTower;
            const grossRevenue = rooms * roomRate * 365 * Math.min(occupancyRate, 1);
            
            const serviceRatio = safeParseFloat(document.getElementById('hotelServiceRatio').value) / 100;
        
            const serviceCost = grossRevenue * serviceRatio;
            const operatingCosts = grossRevenue * operatingCostRatio + serviceCost;
        
            const netIncome = grossRevenue - operatingCosts;
            const roi = totalCost > 0 ? (netIncome / totalCost) * 100 : 0;
            const paybackPeriod = netIncome > 0 ? totalCost / netIncome : Infinity;

            console.log('Hotel tower detailed calculation:', {
                floors,
                floorArea,
                totalArea,
                operationalArea: operationalArea.toFixed(0),
                availableRoomArea: availableRoomArea.toFixed(0),
                roomSize,
                rooms,
                buildCost,
                buildingCost,
                sharedCostPerTower,
                totalCost,
                grossRevenue,
                operatingCosts,
                netIncome,
                roi: roi.toFixed(2) + '%'
            });

            return {
                floors,
                floorArea,
                roomSize,
                buildCost,
                roomRate,
                occupancyRate: occupancyRate * 100,
                operatingCostRatio: operatingCostRatio * 100,
                operationalAreaRatio: operationalAreaRatio * 100,
                totalArea,
                operationalArea,
                availableRoomArea,
                rooms,
                buildingCost,
                totalCost,
                grossRevenue,
                operatingCosts,
                netIncome,
                roi,
                paybackPeriod
            };
        } catch (error) {
            console.error('Error calculating hotel tower:', error);
            throw new Error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ≥ÿßÿ® ÿ®ÿ±ÿ¨ ÿßŸÑŸÅŸÜÿØŸÇ');
        }
    }

    function updateResults() {
        if (!projectData || Object.keys(projectData).length === 0) return;

        try {
            console.log('üî• FULL PROJECT DATA üî•');
            console.log('Complete projectData:', JSON.stringify(projectData, null, 2));
            
            const { sale1, sale2, rental, hotel, totals } = projectData;

            // Log individual tower data
            console.log('Sale1 data:', sale1);
            console.log('Sale2 data:', sale2);
            console.log('Rental data:', rental);
            console.log('Hotel data:', hotel);

            // Update total investment
            document.getElementById('totalInvestmentAmount').textContent = formatNumber(totals.investment) + ' ÿ±ŸäÿßŸÑ';

            // Update summary cards
            document.getElementById('totalAnnualReturn').textContent = totals.annualReturn.toFixed(2) + '%';
            document.getElementById('totalAnnualIncome').textContent = formatNumber(totals.annualIncome) + ' ÿ±ŸäÿßŸÑ';

            // Find best tower by ROI
            const rois = [
                { name: 'ÿ®ÿ±ÿ¨ ÿßŸÑÿ®Ÿäÿπ #1', value: sale1.roi },
                { name: 'ÿ®ÿ±ÿ¨ ÿßŸÑÿ®Ÿäÿπ #2', value: sale2.roi },
                { name: 'ÿ®ÿ±ÿ¨ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ±', value: rental.roi },
                { name: 'ÿ®ÿ±ÿ¨ ÿßŸÑŸÅŸÜÿØŸÇ', value: hotel.roi }
            ];
            const bestROI = rois.reduce((prev, current) => (prev.value > current.value) ? prev : current);
            document.getElementById('bestTowerROI').textContent = bestROI.name + ' (' + bestROI.value.toFixed(1) + '%)';

            // Find highest income tower
            const incomes = [
                { name: 'ÿ®ÿ±ÿ¨ ÿßŸÑÿ®Ÿäÿπ #1', value: sale1.profit || 0 },
                { name: 'ÿ®ÿ±ÿ¨ ÿßŸÑÿ®Ÿäÿπ #2', value: sale2.profit || 0 },
                { name: 'ÿ®ÿ±ÿ¨ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ±', value: rental.annualRent },
                { name: 'ÿ®ÿ±ÿ¨ ÿßŸÑŸÅŸÜÿØŸÇ', value: hotel.netIncome }
            ];
            const highestIncome = incomes.reduce((prev, current) => (prev.value > current.value) ? prev : current);
            document.getElementById('highestIncomeTower').textContent = highestIncome.name;

            // Calculate average payback period
            const paybacks = [rental.paybackPeriod, hotel.paybackPeriod].filter(p => p !== Infinity && !isNaN(p));
            const avgPayback = paybacks.length > 0 ? paybacks.reduce((a, b) => a + b, 0) / paybacks.length : 0;
            document.getElementById('paybackPeriod').textContent = avgPayback > 0 ? avgPayback.toFixed(1) + ' ÿ≥ŸÜÿ©' : 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';

            // Update individual tower results
            console.log('üéØ NOW UPDATING INDIVIDUAL TOWERS');
            updateTowerResults('sale1', sale1);
            updateTowerResults('sale2', sale2);
            updateTowerResults('rental', rental);
            updateTowerResults('hotel', hotel);

            // Highlight best tower
            highlightBestTower();

        } catch (error) {
            console.error('üí• Error updating results:', error);
            showError('ÿÆÿ∑ÿ£ ŸÅŸä ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨');
        }
    }

    function updateTowerResults(towerType, data) {
        try {
            console.log(`üî• SIMPLE UPDATE ${towerType.toUpperCase()} üî•`);
            
            // ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
            document.getElementById(`${towerType}TotalArea`).innerHTML = formatNumber(data.totalArea) + ' ŸÖ¬≤';
            document.getElementById(`${towerType}TotalCost`).innerHTML = formatNumber(data.totalCost) + ' ÿ±ŸäÿßŸÑ';
            document.getElementById(`${towerType}ROI`).innerHTML = data.roi.toFixed(2) + '%';

            // ÿ≠ÿ≥ÿßÿ® ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂ ÿ®ÿ≥Ÿäÿ∑
            const landCostPerTower = projectData.sharedCosts.totalLandCost / 4;
            document.getElementById(`${towerType}LandCost`).innerHTML = `<strong style="color: #f39c12;">${formatNumber(landCostPerTower)} ÿ±ŸäÿßŸÑ</strong>`;
            
            // ÿ≠ÿ≥ÿßÿ® ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ∂ ŸÖŸÜ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿπÿßŸÖÿ©
            const landRatio = data.totalCost > 0 ? (landCostPerTower / data.totalCost) * 100 : 0;
            document.getElementById(`${towerType}LandRatio`).innerHTML = `<strong style="color: #f39c12;">${landRatio.toFixed(1)}%</strong>`;

            // üéØ ÿ≠ÿ≥ÿßÿ® ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ®ŸÜÿßÿ° ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©
            const buildingCost = data.buildingCost || (data.totalArea * (data.buildCost || 0));
            document.getElementById(`${towerType}BuildCostResult`).innerHTML = `<strong style="color: #e74c3c; font-size: 1.1em;">${formatNumber(buildingCost)} ÿ±ŸäÿßŸÑ</strong>`; 

            // ÿ®ÿßŸÇŸä ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑÿ®ÿ±ÿ¨
            if (towerType === 'sale1' || towerType === 'sale2') {
                document.getElementById(`${towerType}Units`).innerHTML = (data.units || 0).toString();
                document.getElementById(`${towerType}Revenue`).innerHTML = formatNumber(data.revenue || 0) + ' ÿ±ŸäÿßŸÑ';
                const profitElement = document.getElementById(`${towerType}Profit`);
                profitElement.innerHTML = formatNumber(data.profit || 0) + ' ÿ±ŸäÿßŸÑ';
                profitElement.className = `result-value ${(data.profit || 0) >= 0 ? 'profit-positive' : 'profit-negative'}`;
                
            } else if (towerType === 'rental') {
                document.getElementById('rentalUnits').innerHTML = (data.units || 0).toString();
                document.getElementById('rentalMonthlyIncome').innerHTML = formatNumber(data.monthlyIncome || 0) + ' ÿ±ŸäÿßŸÑ';
                document.getElementById('rentalAnnualIncome').innerHTML = formatNumber(data.annualRent || 0) + ' ÿ±ŸäÿßŸÑ';
                document.getElementById('rentalPayback').innerHTML = (data.paybackPeriod === Infinity || !data.paybackPeriod) ? 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ' : data.paybackPeriod.toFixed(1) + ' ÿ≥ŸÜÿ©';
                    
            } else if (towerType === 'hotel') {
                document.getElementById('hotelRooms').innerHTML = (data.rooms || 0).toString();
                document.getElementById('hotelOperationalArea').innerHTML = formatNumber(data.operationalArea || 0) + ' ŸÖ¬≤';
                document.getElementById('hotelAvailableRoomArea').innerHTML = formatNumber(data.availableRoomArea || 0) + ' ŸÖ¬≤';
                document.getElementById('hotelGrossRevenue').innerHTML = formatNumber(data.grossRevenue || 0) + ' ÿ±ŸäÿßŸÑ';
                document.getElementById('hotelOperatingCostsAmount').innerHTML = formatNumber(data.operatingCosts || 0) + ' ÿ±ŸäÿßŸÑ';
                const netElement = document.getElementById('hotelNetIncome');
                netElement.innerHTML = formatNumber(data.netIncome || 0) + ' ÿ±ŸäÿßŸÑ';
                netElement.className = `result-value ${(data.netIncome || 0) >= 0 ? 'profit-positive' : 'profit-negative'}`;
                document.getElementById('hotelPayback').innerHTML = (data.paybackPeriod === Infinity || !data.paybackPeriod) ? 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ' : data.paybackPeriod.toFixed(1) + ' ÿ≥ŸÜÿ©';
            }
            
            console.log(`‚úÖ SIMPLE UPDATE COMPLETE FOR ${towerType.toUpperCase()}`);
            
        } catch (error) {
            console.error(`üí• ERROR in simple update ${towerType}:`, error);
        }
    }

    function highlightBestTower() {
        try {
            // Remove existing highlights
            document.querySelectorAll('.tower-result').forEach(el => el.classList.remove('best-tower'));

            if (!projectData) return;

            const { sale1, sale2, rental, hotel } = projectData;
            const rois = [
                { element: 'sale1Results', value: sale1.roi },
                { element: 'sale2Results', value: sale2.roi },
                { element: 'rentalResults', value: rental.roi },
                { element: 'hotelResults', value: hotel.roi }
            ];

            const bestTower = rois.reduce((prev, current) => (prev.value > current.value) ? prev : current);
            const bestElement = document.getElementById(bestTower.element);
            if (bestElement) {
                bestElement.classList.add('best-tower');
            }
        } catch (error) {
            console.error('Error highlighting best tower:', error);
        }
    }

    function exportToCSV() {
        if (!projectData || Object.keys(projectData).length === 0) {
            alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™ ÿ£ŸàŸÑÿßŸã');
            return;
        }

        try {
            const { sale1, sale2, rental, hotel, totals } = projectData;
            
            let csv = 'ŸÜŸàÿπ ÿßŸÑÿ®ÿ±ÿ¨,ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© (ŸÖ¬≤),ÿπÿØÿØ ÿßŸÑŸàÿ≠ÿØÿßÿ™,ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ© (ÿ±ŸäÿßŸÑ),ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂ (ÿ±ŸäÿßŸÑ),ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ∂ (%),ÿßŸÑÿØÿÆŸÑ/ÿßŸÑÿ±ÿ®ÿ≠ ÿßŸÑÿ≥ŸÜŸàŸä (ÿ±ŸäÿßŸÑ),ÿßŸÑÿπÿßÿ¶ÿØ (%),ŸÅÿ™ÿ±ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿØÿßÿØ (ÿ≥ŸÜÿ©)\n';
            
            const landCostPerTower = projectData.sharedCosts.totalLandCost / 4;
            const sale1LandRatio = sale1.totalCost > 0 ? (landCostPerTower / sale1.totalCost) * 100 : 0;
            const sale2LandRatio = sale2.totalCost > 0 ? (landCostPerTower / sale2.totalCost) * 100 : 0;
            const rentalLandRatio = rental.totalCost > 0 ? (landCostPerTower / rental.totalCost) * 100 : 0;
            const hotelLandRatio = hotel.totalCost > 0 ? (landCostPerTower / hotel.totalCost) * 100 : 0;
            
            csv += `ÿ®ÿ±ÿ¨ ÿßŸÑÿ®Ÿäÿπ #1,${sale1.totalArea},${sale1.units},${sale1.totalCost},${landCostPerTower},${sale1LandRatio.toFixed(1)},${sale1.profit},${sale1.roi.toFixed(2)},ŸÅŸàÿ±Ÿä\n`;
            csv += `ÿ®ÿ±ÿ¨ ÿßŸÑÿ®Ÿäÿπ #2,${sale2.totalArea},${sale2.units},${sale2.totalCost},${landCostPerTower},${sale2LandRatio.toFixed(1)},${sale2.profit},${sale2.roi.toFixed(2)},ŸÅŸàÿ±Ÿä\n`;
            csv += `ÿ®ÿ±ÿ¨ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ±,${rental.totalArea},${rental.units},${rental.totalCost},${landCostPerTower},${rentalLandRatio.toFixed(1)},${rental.annualRent},${rental.roi.toFixed(2)},${rental.paybackPeriod === Infinity ? 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ' : rental.paybackPeriod.toFixed(1)}\n`;
            csv += `ÿ®ÿ±ÿ¨ ÿßŸÑŸÅŸÜÿØŸÇ,${hotel.totalArea},${hotel.rooms},${hotel.totalCost},${landCostPerTower},${hotelLandRatio.toFixed(1)},${hotel.netIncome},${hotel.roi.toFixed(2)},${hotel.paybackPeriod === Infinity ? 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ' : hotel.paybackPeriod.toFixed(1)}\n`;
            csv += `\nÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿßÿ™,,,,,,,,\n`;
            csv += `ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ±,,,${totals.investment},,,,\n`;
            csv += `ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿØÿÆŸÑ ÿßŸÑÿ≥ŸÜŸàŸä,,,${totals.annualIncome},,,,\n`;
            csv += `ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿπÿßÿ¶ÿØ ÿßŸÑÿ≥ŸÜŸàŸä,,,,,${totals.annualReturn.toFixed(2)},,\n`;

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ÿ™ŸÇÿ±Ÿäÿ±_ÿßŸÑŸÖÿ¨ŸÖÿπ_ÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑ_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        } catch (error) {
            console.error('Error exporting CSV:', error);
            alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
        }
    }

    function exportToPDF() {
        window.print();
    }

    function generateDetailedReport() {
        if (!projectData || Object.keys(projectData).length === 0) {
            alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™ ÿ£ŸàŸÑÿßŸã');
            return;
        }

        try {
            const reportWindow = window.open('', '_blank');
            const reportHTML = createDetailedReportHTML();
            reportWindow.document.write(reportHTML);
            reportWindow.document.close();
        } catch (error) {
            console.error('Error generating report:', error);
            alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±');
        }
    }

    function createDetailedReportHTML() {
        const { sale1, sale2, rental, hotel, totals } = projectData;
        const currentDate = new Date().toLocaleDateString('ar');
        
        // ÿ≠ÿ≥ÿßÿ® ŸÜÿ≥ÿ® ÿßŸÑÿ£ÿ±ÿßÿ∂Ÿä
        const landCostPerTower = projectData.sharedCosts.totalLandCost / 4;
        const sale1LandRatio = sale1.totalCost > 0 ? (landCostPerTower / sale1.totalCost) * 100 : 0;
        const sale2LandRatio = sale2.totalCost > 0 ? (landCostPerTower / sale2.totalCost) * 100 : 0;
        const rentalLandRatio = rental.totalCost > 0 ? (landCostPerTower / rental.totalCost) * 100 : 0;
        const hotelLandRatio = hotel.totalCost > 0 ? (landCostPerTower / hotel.totalCost) * 100 : 0;

        return `
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
            <meta charset="utf-8">
            <title>ÿ™ŸÇÿ±Ÿäÿ± ŸÖŸÅÿµŸÑ - ÿßŸÑŸÖÿ¨ŸÖÿπ ÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑ</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                .header { text-align: center; border-bottom: 3px solid #667eea; padding-bottom: 20px; margin-bottom: 30px; }
                .summary { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px; }
                .tower-section { margin: 30px 0; padding: 20px; border-radius: 10px; }
                .sale1 { background: rgba(52, 152, 219, 0.1); border-left: 5px solid #3498db; }
                .sale2 { background: rgba(41, 128, 185, 0.1); border-left: 5px solid #2980b9; }
                .rental { background: rgba(39, 174, 96, 0.1); border-left: 5px solid #27ae60; }
                .hotel { background: rgba(230, 126, 34, 0.1); border-left: 5px solid #e67e22; }
                .profit-positive { color: #27ae60; font-weight: bold; }
                .profit-negative { color: #e74c3c; font-weight: bold; }
                .recommendations { background: #e8f5e8; padding: 20px; border-radius: 10px; margin-top: 30px; }
                @media print { body { margin: 20px; } }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>üè¢ ÿ™ŸÇÿ±Ÿäÿ± ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ¨ŸÖÿπ ÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑ - 4 ÿ£ÿ®ÿ±ÿßÿ¨</h1>
                <p>üìÖ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±: ${currentDate}</p>
                <p>üìç ŸÖÿ¨ŸÖÿπ ŸÖÿ™ÿπÿØÿØ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖÿßÿ™ ÿπŸÑŸâ ÿ£ÿ±ÿ∂ Ÿàÿßÿ≠ÿØÿ©</p>
            </div>
            
            <div class="summary">
                <h2>üìã ÿßŸÑŸÖŸÑÿÆÿµ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞Ÿä</h2>
                <ul>
                    <li><strong>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ± ÿßŸÑŸÖÿ∑ŸÑŸàÿ®:</strong> ${formatNumber(totals.investment)} ÿ±ŸäÿßŸÑ</li>
                    <li><strong>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿØÿÆŸÑ ÿßŸÑÿ≥ŸÜŸàŸä ÿßŸÑŸÖÿ™ŸàŸÇÿπ:</strong> ${formatNumber(totals.annualIncome)} ÿ±ŸäÿßŸÑ</li>
                    <li><strong>ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿπÿßÿ¶ÿØ ÿßŸÑÿ≥ŸÜŸàŸä:</strong> ${totals.annualReturn.toFixed(2)}%</li>
                    <li><strong>ÿπÿØÿØ ÿßŸÑÿ£ÿ®ÿ±ÿßÿ¨:</strong> 4 ÿ£ÿ®ÿ±ÿßÿ¨ (2 ÿ®Ÿäÿπ + 1 ÿ•Ÿäÿ¨ÿßÿ± + 1 ŸÅŸÜÿØŸÇ)</li>
                    <li><strong>ÿ•ÿ¨ŸÖÿßŸÑŸä ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ£ÿ±ÿ∂:</strong> ${formatNumber(safeParseFloat(document.getElementById('totalLandArea').value))} ŸÖ¬≤</li>
                </ul>
            </div>

            <h2>üèóÔ∏è ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ£ÿ®ÿ±ÿßÿ¨</h2>
            
            <div class="tower-section sale1">
                <h3>üè¢ ÿ®ÿ±ÿ¨ ÿ¥ŸÇŸÇ ŸÑŸÑÿ®Ÿäÿπ #1</h3>
                <ul>
                    <li>ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ±: ${sale1.floors}</li>
                    <li>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©: ${formatNumber(sale1.totalArea)} ŸÖ¬≤</li>
                    <li>ÿπÿØÿØ ÿßŸÑÿ¥ŸÇŸÇ: ${sale1.units}</li>
                    <li>ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©: ${formatNumber(sale1.totalCost)} ÿ±ŸäÿßŸÑ</li>
                    <li style="color: #f39c12;"><strong>ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂: ${formatNumber(landCostPerTower)} ÿ±ŸäÿßŸÑ (${sale1LandRatio.toFixed(1)}%)</strong></li>
                    <li>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™: ${formatNumber(sale1.revenue)} ÿ±ŸäÿßŸÑ</li>
                    <li class="${sale1.profit >= 0 ? 'profit-positive' : 'profit-negative'}">ÿµÿßŸÅŸä ÿßŸÑÿ±ÿ®ÿ≠: ${formatNumber(sale1.profit)} ÿ±ŸäÿßŸÑ</li>
                    <li>ÿßŸÑÿπÿßÿ¶ÿØ ÿπŸÑŸâ ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ±: ${sale1.roi.toFixed(2)}%</li>
                </ul>
            </div>

            <div class="tower-section sale2">
                <h3>üèòÔ∏è ÿ®ÿ±ÿ¨ ÿ¥ŸÇŸÇ ŸÑŸÑÿ®Ÿäÿπ #2</h3>
                <ul>
                    <li>ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ±: ${sale2.floors}</li>
                    <li>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©: ${formatNumber(sale2.totalArea)} ŸÖ¬≤</li>
                    <li>ÿπÿØÿØ ÿßŸÑÿ¥ŸÇŸÇ: ${sale2.units}</li>
                    <li>ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©: ${formatNumber(sale2.totalCost)} ÿ±ŸäÿßŸÑ</li>
                    <li style="color: #f39c12;"><strong>ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂: ${formatNumber(landCostPerTower)} ÿ±ŸäÿßŸÑ (${sale2LandRatio.toFixed(1)}%)</strong></li>
                    <li>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™: ${formatNumber(sale2.revenue)} ÿ±ŸäÿßŸÑ</li>
                    <li class="${sale2.profit >= 0 ? 'profit-positive' : 'profit-negative'}">ÿµÿßŸÅŸä ÿßŸÑÿ±ÿ®ÿ≠: ${formatNumber(sale2.profit)} ÿ±ŸäÿßŸÑ</li>
                    <li>ÿßŸÑÿπÿßÿ¶ÿØ ÿπŸÑŸâ ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ±: ${sale2.roi.toFixed(2)}%</li>
                </ul>
            </div>

            <div class="tower-section rental">
                <h3>üè† ÿ®ÿ±ÿ¨ ŸÖŸÉÿßÿ™ÿ® ŸÑŸÑÿ•Ÿäÿ¨ÿßÿ±</h3>
                <ul>
                    <li>ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ±: ${rental.floors}</li>
                    <li>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©: ${formatNumber(rental.totalArea)} ŸÖ¬≤</li>
                    <li>ÿπÿØÿØ ÿßŸÑŸÖŸÉÿßÿ™ÿ®: ${rental.units}</li>
                    <li>ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©: ${formatNumber(rental.totalCost)} ÿ±ŸäÿßŸÑ</li>
                    <li style="color: #f39c12;"><strong>ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂: ${formatNumber(landCostPerTower)} ÿ±ŸäÿßŸÑ (${rentalLandRatio.toFixed(1)}%)</strong></li>
                    <li class="profit-positive">ÿßŸÑÿØÿÆŸÑ ÿßŸÑÿ≥ŸÜŸàŸä: ${formatNumber(rental.annualRent)} ÿ±ŸäÿßŸÑ</li>
                    <li>ÿßŸÑÿπÿßÿ¶ÿØ ÿßŸÑÿ≥ŸÜŸàŸä: ${rental.roi.toFixed(2)}%</li>
                    <li>ŸÅÿ™ÿ±ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿØÿßÿØ: ${rental.paybackPeriod === Infinity ? 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ' : rental.paybackPeriod.toFixed(1) + ' ÿ≥ŸÜÿ©'}</li>
                </ul>
            </div>

            <div class="tower-section hotel">
                <h3>üè® ÿ®ÿ±ÿ¨ ŸÅŸÜÿØŸÇ ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ</h3>
                <ul>
                    <li>ÿπÿØÿØ ÿßŸÑÿ£ÿØŸàÿßÿ±: ${hotel.floors}</li>
                    <li>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©: ${formatNumber(hotel.totalArea)} ŸÖ¬≤</li>
                    <li style="color: #f39c12;"><strong>ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑŸäÿ©: ${formatNumber(hotel.operationalArea)} ŸÖ¬≤ (${hotel.operationalAreaRatio}%)</strong></li>
                    <li style="color: #27ae60;"><strong>ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ∫ÿ±ŸÅ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©: ${formatNumber(hotel.availableRoomArea)} ŸÖ¬≤</strong></li>
                    <li>ÿπÿØÿØ ÿßŸÑÿ∫ÿ±ŸÅ: ${hotel.rooms}</li>
                    <li>ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©: ${formatNumber(hotel.totalCost)} ÿ±ŸäÿßŸÑ</li>
                    <li style="color: #f39c12;"><strong>ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑÿ£ÿ±ÿ∂: ${formatNumber(landCostPerTower)} ÿ±ŸäÿßŸÑ (${hotelLandRatio.toFixed(1)}%)</strong></li>
                    <li class="profit-positive">ÿßŸÑÿ•Ÿäÿ±ÿßÿØ ÿßŸÑÿ≥ŸÜŸàŸä ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${formatNumber(hotel.grossRevenue)} ÿ±ŸäÿßŸÑ</li>
                    <li class="profit-negative">ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑŸäÿ©: ${formatNumber(hotel.operatingCosts)} ÿ±ŸäÿßŸÑ</li>
                    <li class="${hotel.netIncome >= 0 ? 'profit-positive' : 'profit-negative'}">ÿµÿßŸÅŸä ÿßŸÑÿØÿÆŸÑ ÿßŸÑÿ≥ŸÜŸàŸä: ${formatNumber(hotel.netIncome)} ÿ±ŸäÿßŸÑ</li>
                    <li>ÿßŸÑÿπÿßÿ¶ÿØ ÿßŸÑÿµÿßŸÅŸä: ${hotel.roi.toFixed(2)}%</li>
                    <li>ŸÅÿ™ÿ±ÿ© ÿßŸÑÿßÿ≥ÿ™ÿ±ÿØÿßÿØ: ${hotel.paybackPeriod === Infinity ? 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ' : hotel.paybackPeriod.toFixed(1) + ' ÿ≥ŸÜÿ©'}</li>
                </ul>
            </div>

            <div class="recommendations">
                <h2>üí° ÿßŸÑÿ™ŸàÿµŸäÿßÿ™ ŸàÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</h2>
                <ul>
                    <li><strong>ÿßŸÑÿ™ŸÜŸàŸäÿπ ÿßŸÑÿ∞ŸÉŸä:</strong> ŸäŸàŸÅÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ™ŸÜŸàŸäÿπÿßŸã ŸÖŸÖÿ™ÿßÿ≤ÿßŸã ÿ®ŸäŸÜ ÿßŸÑÿßÿ≥ÿ™ÿ´ŸÖÿßÿ±ÿßÿ™ ŸÇÿµŸäÿ±ÿ© Ÿàÿ∑ŸàŸäŸÑÿ© ÿßŸÑŸÖÿØŸâ</li>
                    <li><strong>ÿßŸÑÿ™ŸÉÿßŸÖŸÑ:</strong> ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉÿ© ÿ™ÿπÿ≤ÿ≤ ŸÖŸÜ ŸÇŸäŸÖÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ®ÿ±ÿßÿ¨</li>
                    <li><strong>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿßÿ∑ÿ±:</strong> ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸÖÿÆÿßÿ∑ÿ± ÿπŸÑŸâ 4 ÿ£ŸÜŸàÿßÿπ ÿßÿ≥ÿ™ÿ´ŸÖÿßÿ± ŸÖÿÆÿ™ŸÑŸÅÿ©</li>
                    <li><strong>ÿßŸÑÿ≥ŸäŸàŸÑÿ©:</strong> ÿ®ÿ±ÿ¨Ÿä ÿßŸÑÿ®Ÿäÿπ ŸäŸàŸÅÿ±ÿßŸÜ ÿ≥ŸäŸàŸÑÿ© ŸÅŸàÿ±Ÿäÿ© ŸÑÿ™ŸÖŸàŸäŸÑ ÿ®ÿßŸÇŸä ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ</li>
                    <li><strong>ÿßŸÑÿØÿÆŸÑ ÿßŸÑŸÖÿ≥ÿ™ŸÖÿ±:</strong> ÿ®ÿ±ÿ¨ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ± ŸàÿßŸÑŸÅŸÜÿØŸÇ Ÿäÿ∂ŸÖŸÜÿßŸÜ ÿØÿÆŸÑÿßŸã ŸÖÿ≥ÿ™ŸÖÿ±ÿßŸã</li>
                    <li><strong>ÿ™ÿ≠ŸÑŸäŸÑ ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ£ÿ±ÿ∂:</strong> ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿ™ŸÇŸÑÿ®ÿßÿ™ ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ£ÿ±ÿßÿ∂Ÿä ÿπŸÑŸâ ŸÉŸÑ ÿ®ÿ±ÿ¨ ÿ≠ÿ≥ÿ® ŸÜÿ≥ÿ®ÿ™Ÿá</li>
                    <li><strong>ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÅŸÜÿØŸÇ:</strong> ÿ™ŸÖ ÿßÿ≠ÿ™ÿ≥ÿßÿ® ÿπÿØÿØ ÿßŸÑÿ∫ÿ±ŸÅ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÅÿπŸÑŸäÿ© ÿ®ÿπÿØ ÿßÿ≥ÿ™ÿ®ÿπÿßÿØ ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑŸäÿ©</li>
                </ul>
            </div>
            
            <footer style="margin-top: 50px; text-align: center; color: #666; border-top: 1px solid #ddd; padding-top: 20px;">
                <p>ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° Ÿáÿ∞ÿß ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑŸÖÿ¨ŸÖÿπ ÿßŸÑŸÖÿ™ŸÉÿßŸÖŸÑ</p>
                <p><small>Ÿáÿ∞ÿß ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ŸÑŸÑÿ£ÿ∫ÿ±ÿßÿ∂ ÿßŸÑÿßÿ≥ÿ™ÿ¥ÿßÿ±Ÿäÿ© ŸÅŸÇÿ∑ ŸàŸÑÿß Ÿäÿ¥ŸÉŸÑ ŸÜÿµŸäÿ≠ÿ© ÿßÿ≥ÿ™ÿ´ŸÖÿßÿ±Ÿäÿ© ŸÖŸÑÿ≤ŸÖÿ©</small></p>
            </footer>
        </body>
        </html>
        `;
    }

    function saveProject() {
        if (!projectData || Object.keys(projectData).length === 0) {
            alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™ ÿ£ŸàŸÑÿßŸã');
            return;
        }

        try {
            const inputs = {};
            document.querySelectorAll('input').forEach(input => {
                inputs[input.id] = input.value;
            });

            const saveData = {
                inputs: inputs,
                results: projectData,
                timestamp: new Date().toISOString(),
                projectType: 'ŸÖÿ¨ŸÖÿπ ŸÖÿ™ŸÉÿßŸÖŸÑ - 4 ÿ£ÿ®ÿ±ÿßÿ¨'
            };

            const projectName = prompt('ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ:', `ŸÖÿ¨ŸÖÿπ_ŸÖÿ™ŸÉÿßŸÖŸÑ_${new Date().toLocaleDateString('ar')}`);
            if (projectName) {
                const blob = new Blob([JSON.stringify(saveData, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${projectName}.json`;
                link.click();
                
                alert('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ®ŸÜÿ¨ÿßÿ≠');
            }
        } catch (error) {
            console.error('Error saving project:', error);
            alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ');
        }
    }

    // Input validation
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('input', function() {
            let value = parseFloat(this.value);
            
            if (isNaN(value) || value < 0) {
                this.value = 0;
                return;
            }
            
            // Specific validations
            if (this.id === 'sharedAreaRatio' && value > 50) {
                this.value = 50;
            } else if (this.id === 'hotelOperationalAreaRatio' && value > 50) {
                this.value = 50;
            } else if (this.id.includes('OccupancyRate') && value > 100) {
                this.value = 100;
            } else if (this.id.includes('OperatingCosts') && value > 100) {
                this.value = 100;
            } else if (this.id === 'loanRatio' && value > 100) {
                this.value = 100;
            } else if (this.id === 'interestRate' && value > 50) {
                this.value = 50;
            }
            
            // Ensure minimum values for critical fields
            if ((this.id.includes('Size') || this.id.includes('Floors')) && value < 1) {
                this.value = 1;
            }
        });
    });

    // Auto-calculate with debounce
    let debounceTimer;
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                if (Object.keys(projectData).length > 0) {
                    calculateProject();
                }
            }, 2000);
        });
    });

    // Print styles
    const printStyles = `
        <style media="print">
            body { background: white !important; }
            .container { box-shadow: none !important; background: white !important; }
            .export-buttons, .calculate-btn, .towers-inputs-grid, .inputs-section, .shared-costs-section { display: none !important; }
            h1 { color: black !important; -webkit-text-fill-color: black !important; }
            .tower-result, .summary-card { border: 2px solid #333 !important; }
            .project-overview { page-break-after: always; }
        </style>
    `;
    document.head.insertAdjacentHTML('beforeend', printStyles);

    // Initialize with sample calculation
    window.addEventListener('load', function() {
        // Auto-calculate after a short delay to show functionality
        setTimeout(() => {
            calculateProject();
        }, 1000);
    });

</script>
<script id="defaultProjectData" type="application/json">{
  "inputs": {
    "totalLandArea": "16000",
    "landCostPerMeter": "15000",
    "sharedAreaRatio": "15",
    "sharedAreaCost": "3000",
    "infrastructureCost": "5000000",
    "designAndPlanningCost": "2000000",
    "sale1Floors": "12",
    "sale1FloorArea": "2000",
    "sale1ApartmentSize": "140",
    "sale1BuildCost": "4500",
    "sale1SellPrice": "7500",
    "sale2Floors": "12",
    "sale2FloorArea": "2000",
    "sale2ApartmentSize": "140",
    "sale2BuildCost": "4500",
    "sale2SellPrice": "7500",
    "rentalFloors": "12",
    "rentalFloorArea": "2000",
    "rentalOfficeSize": "300",
    "rentalBuildCost": "5000",
    "rentalPricePerMeter": "1200",
    "rentalOccupancyRate": "80",
    "hotelFloors": "12",
    "hotelFloorArea": "2000",
    "hotelRoomSize": "50",
    "hotelBuildCost": "6500",
    "hotelRoomRate": "650",
    "hotelOccupancyRate": "70",
    "hotelOperatingCosts": "30",
    "hotelOperationalAreaRatio": "25",
    "hotelServiceRatio": "10",
    "loanRatio": "0",
    "loanYears": "0",
    "interestRate": "0"
  }
}</script></body>
</html>