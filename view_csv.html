<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CSV Browser</title>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">

<style>
  body { font-family: Arial, sans-serif; margin: 18px; }
  h2 { margin: 0 0 10px 0; font-size: 18px; }
  .bar { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px; }
  select, input[type="text"], button { padding: 6px; }

  /* ===== HEADERS CENTER ===== */
  #csvTable thead th {
    text-align: center !important;
    vertical-align: middle;
  }

  /* ===== CELLS CENTER ===== */
  #csvTable tbody td {
    text-align: center;
    vertical-align: middle;
    overflow: visible; /* Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§ */
  }

  /* ===== TITLE LEFT ===== */
  #csvTable td.col-title {
    text-align: left !important;
  }

  /* ===== IMAGE BASE ===== */
  .img-wrap {
    position: relative;
    display: inline-block;
    overflow: visible; /* Ù…Ù‡Ù… */
  }

  .img-wrap img {
    max-height: 40px;
    border-radius: 6px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: zoom-in;
    background: #fff;
    transform-origin: left center; /* ðŸ”¥ ÙŠÙƒØ¨Ø± Ù„Ù„ÙŠÙ…ÙŠÙ† */
  }

  /* ===== HOVER ZOOM (RIGHT) ===== */
  .img-wrap:hover img {
    transform: scale(4);
    z-index: 9999;
    position: relative;
    box-shadow: 0 12px 35px rgba(0,0,0,0.35);
    border-radius: 12px;
  }

  table.dataTable thead th {
    position: sticky;
    top: 0;
    background: #fff;
    z-index: 2;
  }
</style>
</head>

<body>
<h2>CSV Browser</h2>

<div class="bar">
  <select id="csvSelect"></select>
  <input id="quickSearch" type="text" placeholder="Search..." />
  <button id="reloadBtn">Reload</button>
  <span id="status" style="color:#666;font-size:12px;"></span>
</div>

<table id="csvTable" class="display compact stripe" style="width:100%"></table>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
/* ============ CONFIG ============ */
const CSV_FILES = [
  "first_aid_Search_7pages_amazon_2026-01-28_320_products.csv",
  "collagen_best_7_pages_manual_amazon_2026-01-27_280_products (2).csv",
  "Fire_Extinguishers_10pages_outof_67pages_amazon_2026_01_28_267_products.csv",
  "Fire_Safety_best_8pages_outof_400pagesamazon_2026_01_28_183_products (2).csv",
  "Fire_Safety_best_8pages_outof_400p_Testing - Copy.csv",
  "Baby_Safety_Products_best_10pages_outof_400pages_amazon_2026_01.csv",
  "Collagen_Supplements_166Pages_amazon_2026_01_27_4066_products_1.csv",
  "Vitamin_C_Supplements_15pages_outof_117pages_amazon_2026_01_28_358.csv",
  "Vitamins,_Minerals_&_Supplements_10pages_outof_400_amazon_2026_01.csv",
  "Vitamins_15Pages_out_of_400page_amazon_2026_01_27_233_products.csv",
  "Baby_Safety_Products_best_10pages_outof_400pages_amazon_2026-01-28_263_products.csv",
  "collagen_best_7_pages_manual_amazon_2026-01-27_280_products.csv",
  "Collagen_Supplements_166Pages_amazon_2026_01_27_4066_products (1).csv",
  "sleep_supplements_170pages_amazon_us.csv",
  "collagen_117pages_all_split_final.csv",
  "collagen_117pages.csv",
  "400pages_all_split_final.csv"
];

const VISIBLE_COLS = [
  "image","title","price","rating","reviews",
  "revenue30Day","unitSales30Day",
  "category1","bsr1",
  "category2","bsr2",
  "category3","bsr3",
  "url"
];
/* ================================ */

let table = null;
let currentCSV = CSV_FILES[0];

function setStatus(msg){ document.getElementById("status").textContent = msg || ""; }

function moneyToNum(v){
  if (v === null || v === undefined) return 0;
  const s = String(v).trim().replace(/[^0-9.]/g,'');
  return s ? parseFloat(s) : 0;
}

function buildColumns(sampleRow){
  const keys = new Set(Object.keys(sampleRow || {}));
  return VISIBLE_COLS
    .filter(c => keys.has(c))
    .map(c => ({
      title: c,
      data: c,
      className: (c === "title") ? "col-title" : ""
    }));
}

function loadCSV(filename){
  currentCSV = filename;
  setStatus("Loading: " + filename);

  fetch(encodeURI(filename), { cache: "no-store" })
    .then(res => {
      if (!res.ok) throw new Error("CSV not found: " + filename);
      return res.text();
    })
    .then(text => {
      Papa.parse(text, {
        header: true,
        skipEmptyLines: true,
        complete: res => buildTable(res.data || [])
      });
    })
    .catch(err => {
      console.error(err);
      setStatus("Error: " + err.message);
      alert(err.message);
    });
}

function buildTable(rows){
  rows = rows.filter(r => r && Object.keys(r).length);
  if (!rows.length) return;

  rows.forEach(r => {
    r.price_num = moneyToNum(r.price);
    r.revenue30Day_num = moneyToNum(r.revenue30Day);

    r.image = r.image
      ? `<div class="img-wrap"><img src="${r.image}" loading="lazy"></div>`
      : "";

    r.url = r.url
      ? `<a href="${r.url}" target="_blank">open</a>`
      : "";
  });

  let columns = buildColumns(rows[0]);
  columns.push({ data:"revenue30Day_num" });
  columns.push({ data:"price_num" });

  const revIdx = columns.findIndex(c => c.data === "revenue30Day_num");
  const priceIdx = columns.findIndex(c => c.data === "price_num");

  if (table) {
    table.destroy();
    $("#csvTable").empty();
  }

  table = $("#csvTable").DataTable({
    data: rows,
    columns,
    columnDefs: [
      { targets: [revIdx, priceIdx], visible:false, searchable:false }
    ],
    order: revIdx >= 0 ? [[revIdx,"desc"]] : [],
    pageLength: 50,
    lengthMenu: [10,25,50,100,200],
    scrollX: true,
    deferRender: true,
    processing: true,
    dom: "Bfrtip",
    buttons: ["copy","csv","excel","print"]
  });

  document.getElementById("quickSearch").oninput = function(){
    table.search(this.value).draw();
  };

  setStatus(`Loaded ${rows.length} rows`);
}

/* dropdown */
const sel = document.getElementById("csvSelect");
CSV_FILES.forEach(f => {
  const o = document.createElement("option");
  o.value = f;
  o.textContent = f;
  sel.appendChild(o);
});
sel.value = currentCSV;
sel.onchange = () => loadCSV(sel.value);

document.getElementById("reloadBtn").onclick = () => loadCSV(currentCSV);

/* auto-load */
loadCSV(currentCSV);
</script>
</body>
</html>
